!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f783f539-9947-3e75-b3fe-d421f515f526")}catch(e){}}();
define(["exports","react","./e_file_viewer_static_scl_page_file","./c_core_i18n","./c_stacks_async_add_to_stack","./e_data_modules_stormcrow","./e_edison","./c_spectrum_util_raf_throttle","./c_api_v2_unauthed_client","./c_bem","./c_dotlottie_common_chunk-B7OIQIGJ","./c_chat_chat_constants","./c_src_sink_index","./c_inband-screen_internals_share-modal-share","./c_src_utils_initials","./c_browse_welcome_hub_lib_types","./c_utils_dsx_dsx-react","./c_shareme24_main","./c_account_email","./c_account_email_verify_reasons","./c_init_data_edison","./e_core_exception","./c_api_v2_routes_restorations_provider","./c_lodash-es_lodash","./c_hive_schemas_sharing-request_access_user_events","./c_core_notify","react-dom","./c_api_v2_routes_team_insights_provider","./c_security_csrf_hmac","./c_react-use_useEffectOnce","./c_pap-events_navigation_select_create_folder_action","react/jsx-runtime","metaserver/static/js/langpack","./c_over-quota_over-quota-sweep-blocking-modal_show_over_quota_modal_or_continue","./c_over-quota_over-quota-sweep-blocking-modal_open_over_quota_restrictions_modal","./c_over-quota_utils_use_get_plans","./c_trial-plan-card_components_header","./c_dig-components_combinations_index","./c_dig-icons_assets_ui-icon_line_tag","./c_trial-cards_trial-plan-card","./c_dig-components_meter_index","./c_react-hookz_web_useRafCallback","./c_growth-components_over-quota-file-viewer-modal","./c_over-quota_utils_oq_price_decrease_helper","./c_custom_campaigns_out_of_space_modal_out_of_space_checkout_modal_logger","./c_react-use_misc_util","./c_abuse_fingerprintjs_abuse_fpjs_provider","./c_abuse_fingerprintjs_abuse_fpjs_context","./c_fingerprintjs_fpjs-pro-static_fp","./c_common_components_buttons","./c_contacts_contact","./c_validators","./c_proto_storefront_platform_js_init_data_types_pb","./c_components_change_plan_utils","./c_proto_storefront_platform_js_init_data_transition_pb","./c_proto_checkout_js_init_data_checkout_page_pb","./c_cash_common_common_pb","./c_proto_storefront_platform_js_init_data_usage_data_pb","./c_sharing_sharing_pap_logging_send_share_invite_util","./c_dig-components_chip_index","./c_dig-components_typeahead_index","./c_dig-icons_assets_ui-icon_line_share","./c_api-v2-client_src_dropbox","./c_react_query_helpers_queries_login_and_register_constants","./c_ui_contextual-nudge_campaign-contextual-nudge-section","./c_ui_locked-state-modal_open_locked_state_modal","./c_dig-components_card_index","./c_dig-icons_assets_ui-icon_line_upsell","./c_dig-icons_assets_ui-icon_line_stacks","./c_over-quota_over-quota-sweep-blocking-modal_over_quota_sweep_blocking_modal_wrapper","./c_ui_contextual-nudge_atoms","./c_common_components_layout","./c_content-member-list_internals_content-member-list","./c_dig-icons_assets_ui-icon_line_team","./c_dig-illustrations_spot_bowl-empty","./c_dig-content-icons_icons_folder-shared-default-small","./c_dig-icons_assets_ui-icon_line_external-member","./c_settings-page_internals_settings-page-wrapper","./c_dig-components_tabs_index","./c_components_icons_icon_dropdown_selected","./c_date-fns__lib_requiredArgs_index","./c_dig-icons_assets_ui-icon_line_settings","./c_user_metadata_api","./c_dig-icons_assets_ui-icon_line_qr-code","./c_ui_modal_dig","./c_form","./c_account_email_verify","./c_auth_webauthn"],(function(e,t,a,n,r,i,s,o,c,_,l,d,u,p,g,m,f,h,v,E,y,b,S,C,M,w,x,k,I,$,A,O,T,L,q,D,P,R,F,j,N,V,H,U,B,Q,W,G,z,Y,K,Z,J,X,ee,te,ae,ne,re,ie,se,oe,ce,_e,le,de,ue,pe,ge,me,fe,he,ve,Ee,ye,be,Se,Ce,Me,we,xe,ke,Ie,$e,Ae,Oe,Te,Le){"use strict";function qe(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var n=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var De=qe(t);a.createApiv2Query({nsClient:r.GetStacksRoutes,rpc:"query_stacks"});const Pe=a.createApiv2Query({nsClient:a.GetFilesRoutes,rpc:"list_folder"}),Re=(e,t=!0)=>{t?a.fail(e.formatMessage({id:"ObEiUD",defaultMessage:"Couldn’t complete this request. Try again."})):a.fail(e.formatMessage({id:"VAAIgQ",defaultMessage:"Couldn’t complete this request."}))},Fe=({children:e,onFallback:t,onRequestClose:r})=>{const i=h.useData(),s=De.useRef(!1),o=(()=>{const e=n.useIntl();return De.useCallback((t=>{switch(t.loadError.type){case"METADATA_ERROR_V2":switch(t.loadError.response.error[".tag"]){case"email_unverified":return a.fail(e.formatMessage({id:"YQ+xBi",defaultMessage:"Verify your email to share this content."})),!0;case"invalid_oid":return a.fail(e.formatMessage({id:"hBQISs",defaultMessage:"This content doesn’t exist."})),!0;case"no_access":return a.fail(e.formatMessage({id:"S0dPqX",defaultMessage:"You don’t have access to this content."})),!0;case"other":return Re(e),!0;default:return a.exhausts(t.loadError.response.error[".tag"],!1)}case"METADATA_FATAL_V2":return Re(e),!0;default:return!1}}),[e])})();return De.useEffect((()=>{if("error"===i.status&&!s.current){s.current=!0;o(i)?r():t&&t()}}),[i,t,r,o]),De.createElement(De.Fragment,null,e)};Fe.displayName="DataLoadingErrorWrapper";const je=Symbol("ON_SHOW_VERIFY_EMAIL_MODAL"),{useEmitter:Ne,defaultEmitter:Ve}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),r=t(a.Context$5),i=t(a.Context$6),s=t(a.Context$7),o={...a.getTags$4(n),...a.getTags$5(r),...a.getTags$6(i),...a.getTags$7(s),isSm24:"true"},c={...a.getProperties$4(n),...a.getProperties$5(r),...a.getProperties$6(i),...a.getProperties$7(s)};e.key===je&&(a.UDCL.logEnd("ops.sm24.browse_load",{eventState:"canceled",key:e.payload.sessionId,tags:o}),a.UDCL.logEnd(a.PAP_Load_ShareModal({eventState:"canceled",...c}),{eventState:"canceled",key:e.payload.sessionId,tags:o}),a.UDCL.logEvent("ops.sm24.show_verify_email_modal",{tags:o}))})),He=({children:e,sessionId:t,onRequestClose:n})=>{var r,i;const s=Ne(),{viewer:o,isLoading:c}=a.useViewer(),_=!c&&!1===(null===(r=o.active_user)||void 0===r?void 0:r.is_email_verified);return De.default.useEffect((()=>{_&&s.select(je).emit({sessionId:t})}),[_,t,s]),_?De.default.createElement(v.VerifyEmailModal,{viewer:o,user:o.active_user,reason:E.EmailVerificationReasons.SHMODAL,email:null===(i=o.active_user)||void 0===i?void 0:i.email,onShowChange:()=>{o.active_user&&v.ChangeEmail.show(o,o.active_user,E.EmailVerificationReasons.SHMODAL)},onEmailSent:()=>{v.EmailVerification.get_for_user(o,o.active_user).email_sent(void 0,E.EmailVerificationReasons.SHMODAL,!0),n()},onCancel:n}):De.default.createElement(De.default.Fragment,null,e)};He.displayName="EmailVerificationWrapper";const Ue=e=>{var t;const a=(e=>f.useInitStore(e,(e=>{const t=f.proxy((()=>e.get().user)),a=f.proxy((()=>e.get().shareModalExtras)),n=f.proxy((()=>{var t;return null===(t=e.get().shareModalExtras)||void 0===t?void 0:t.origin})),r=f.proxy((()=>e.get().actionSurface)),i=f.proxy((()=>e.get().actionElement)),s=f.proxy((()=>e.get().progressiveInbandVariant)),o=f.store(Date.now()),c=f.store(void 0),_=f.store(e.get().isOpen),l=f.proxy((()=>e.get().sessionId)),d=f.proxy((()=>e.get().displayType)),u=f.proxy((()=>{const t=e.get();if("anchored"===t.displayType)return t.anchorRef})),p=f.proxy((()=>{const t=e.get();if("anchored"===t.displayType)return t.overlayPlacement}));return{$user:t,$shareModalExtras:a,$isOpen:_,$origin:n,$actionSurface:r,$actionElement:i,$progressiveInbandVariant:s,$openFlexibleEntryPointTimestamp:o,$dwellFlexibleEntryPointActionTimestamp:c,$sessionId:l,$displayType:d,$anchorRef:u,$overlayPlacement:p,$props:e}})))(e);return De.createElement(De.Fragment,null,De.createElement(m.SharingSdkProvider,{userApiProps:e.user,origin:null===(t=e.shareModalExtras)||void 0===t?void 0:t.origin,actionInfo:{actionSurface:e.actionSurface}},De.createElement(Be,{store:a})))};Ue.displayName="ShareMe24Browse";const Be=({store:e})=>{var t,s,o;const{user:c,fileOrFolder:_,actionSurface:l,actionElement:d,onActionClicked:u}=e.$props.get(),[v,E]=De.useState(a.getObjectIdentifier(_)),y=a.getFilename(_),b=_.is_dir,S=f.useStore(e.$origin),C=f.useStore(e.$sessionId),M=f.useStore(e.$isOpen),w=f.useStore(e.$anchorRef),x=f.useStore(e.$overlayPlacement),k=f.useStore(e.$displayType),I=i.useQueryClient();b&&((e,t)=>{Pe.prefetchQuery(e,{apiArg:{path:t,limit:r.STACK_SIZE_LIMIT}})})(I,_.file_id);const{variant:$}=a.useExperimentVariant("sharing_lego_settings_page"),A="V1"===$;a.useLogExposureOnce("sharing_lego_settings_page");const O=(e=>De.default.useCallback((()=>{e.$props.get().onRequestClose(),e.$dwellFlexibleEntryPointActionTimestamp.set(void 0)}),[e]))(e),T=(e=>De.default.useCallback((()=>{var t,a;null===(a=(t=e.$props.get()).onInbandShareCompleted)||void 0===a||a.call(t),e.$isOpen.set(!1)}),[e]))(e),L=De.useCallback((async e=>{a.markMilestoneAsCompleted(e,m.ActivationTileMilestoneId.SHARE_CONTENT)}),[]);De.useEffect((()=>{(async()=>{if(!v.fileId||""===v.fileId){const e=await g.fetchLegacySharingObjectMetadataObjectIdentifier(v);E(e)}})()}),[v]);const q=De.useMemo((()=>_.is_dir?_.target_ns?{type:"shared_folder"}:{type:"file_folder"}:{type:"file",name:y,size:_.bytes}),[y,_]),D=De.useMemo((()=>({actionSurface:l,actionElement:d,contentAction:"share",tiburonOrigin:S,screen:"share_screen",shareModalType:"sm24"})),[l,d,S]),P=f.useStore(e.$progressiveInbandVariant),R=f.useStore(e.$props).onFallback,{data:F,isLoading:j}=a.useSharingPrefs(),N=null!==(t=null==F?void 0:F.apiData.is_file_transfer_enabled)&&void 0!==t&&t,V=b?r.folderEligibleForTransfer(_):!_.is_cloud_doc,H=c.is_team_admin,U=j,B=!!(null===(o=null===(s=a.useDashAccess().data)||void 0===s?void 0:s.apiData.feature_attributes)||void 0===o?void 0:o.has_stacks_in_fss);let Q=null,W=De.useMemo((()=>b?null:[{file_id:_.file_id,fq_path:_.fq_path}]),[b,_]);const G=((e,t=!1)=>{const a=Pe.useQuery({apiArg:{path:e,limit:r.STACK_SIZE_LIMIT}},{staleTime:3e5,enabled:t});return De.useMemo((()=>{var e;if(a.isLoading)return{isLoading:!0};if(a.error)return{isLoading:!1,isError:!0,error:a.error.appError};{const t=a.data.apiData;if(t.has_more)return{isLoading:!1,isError:!0,error:{".tag":"too_many_contents"}};const n=[];for(const a of t.entries)if("id"in a){if("folder"===a[".tag"]&&(null===(e=a.sharing_info)||void 0===e?void 0:e.no_access))continue;n.push({file_id:a.id,fq_path:a.name})}return{isError:!1,isLoading:!1,output:n}}}),[a])})(_.file_id,b);G.isLoading||(G.isError?Q="too_many_contents"===G.error[".tag"]:(W=G.output,Q=!1));const z=a.useShowCopyLinkMiniModalCallback(),Y=De.useMemo((()=>"centered"===k?{initialDisplayMode:"centered_v1"}:{initialDisplayMode:"anchored_v1",displayModeRef:w,displayModePositioning:x}),[k,w,x]),K=De.useCallback((()=>{var t;const{actionSurface:a,actionElement:n,user:r,shareModalExtras:i,...s}=e.$props.get();"anchored"===s.displayType&&(null===(t=s.onHoverLocked)||void 0===t||t.call(s,{isOpen:!0}));let o=()=>{};const c=new Promise((e=>{o=e}));if("undefined"!=typeof ClipboardItem&&navigator.clipboard.write){const e=new ClipboardItem({"text/plain":c});navigator.clipboard.write([e])}else c.then((e=>navigator.clipboard.writeText(e)));const l={write:e=>o(e)},d="undefined"!=typeof window&&window.innerWidth<=800?"bottom":x;L(r);const u="anchored"===s.displayType?{isCenteredDisplayed:!1,anchorRef:s.anchorRef,placement:d,yOffsetDistance:5,onHoverLocked:s.onHoverLocked}:{isCenteredDisplayed:!0};z.fn({user:r,filePath:_.file_id,setIsCreatingSharedLink:()=>{},browseFile:_,zIndexOverride:500,actionSurface:a,actionElement:n,origin:null==i?void 0:i.origin,isFromShareMe24Modal:!0,clipboardWriter:l,withLockedStateModal:!1,userActionSource:null==i?void 0:i.userActionSource,...u})}),[e.$props,x,z,L,_]),Z=De.useCallback((()=>{const e=`sm24_${l}_${d}`,t=[_];r.asyncShowBrowseEntryPointOnboardingModal({primaryActionOnClick:()=>r.redirectToCreateTransferWithFiles(t,e),userId:c.id})}),[d,l,_,c.id]),J=(e=>De.useCallback((t=>{const n=e.$props.get(),r=n.user,i=n.fileOrFolder,s={...n.shareModalExtras,initialScreen:a.SETTINGS_SCREEN,openSettingsFromShareMe24:!0,openLinkSettings:t.shouldOpenLinkSettings,initialTab:t.initialTab};a.asyncShowShareModal(r,i,s)}),[e]))(e),X=(e=>{const t=a.useExperimentVariant("sharing_access_management_entry_point_expansion"),n=t.isLoading?"OFF":t.variant;return De.useCallback((()=>{const t=e.$props.get(),r=t.user,i=t.fileOrFolder,s={...t.shareModalExtras,initialScreen:a.MANAGE_SCREEN,openSettingsFromShareMe24:!0,openLinkSettings:!1};n&&n!==a.Variant.OFF&&a.logExposure({feature:"sharing_access_management_entry_point_expansion",variant:n}),"ON"===n?a.asyncShowAccessManagementBrowse({fileOrFolder:i,user:r,actionSurface:"browse_integration_manage_permissions",actionElement:"access_management",sessionId:Math.random().toString()}):a.asyncShowShareModal(r,i,s)}),[e,n])})(e),ee=De.useCallback((async()=>{if(!W)return;const{actionSurface:t}=e.$props.get(),i=We(t),s=b?y:void 0;r.asyncAddToStack(n.intl,I,a.CompatNavigate.navigate,W,i,s)}),[W,y,b,I,e.$props]);return De.createElement("div",null,De.createElement(He,{sessionId:C,onRequestClose:O},De.createElement(m.MetadataProvider,{sharingObjectIdentifier:v,shareModalSessionId:C},De.createElement(a.ContextProvider,{context:p.Context,value:C},De.createElement(a.ContextProvider,{context:a.Context$4,value:D},De.createElement(a.ContextProvider,{context:a.Context$5,value:q},De.createElement(h.Provider,{objectIdentifier:v,sessionId:C,objMetadataNewApiVariant:"OFF"},De.createElement(Qe,{sessionId:C,actionElement:d,actionSurface:l,isDir:b},De.createElement(Fe,{onFallback:R,onRequestClose:O},De.createElement(h.Main,{...Y,isOpen:M,onRequestClose:O,inbandSharingMode:"controlled_v1",copyLinkMode:"controlled_v1",copyLinkHandler:K,transferMode:"controlled_v1",transferHandler:Z,settingsMode:A?"integrated_v1":"controlled_v1",settingsHandler:J,manageAccessHandler:X,objectIdentifier:v,isEncrypted:_.is_encrypted,fileName:y,fileSize:_.bytes,filePath:_.fq_path,progressiveInbandVariant:P,canUserUseTransfer:N,canContentUseTransfer:V,canUserEnableTransfer:H,isTransferEligibilityLoading:U,referrerLoggingMetadata:D,objectLoggingMetadata:q,onActionClicked:u,onInbandShareCompleted:T,canUserCreateStack:B,isFolderFileCountOverLimit:Q,contents:W,createStackHandler:ee,onObjectIdentifierChanged:()=>Promise.resolve()}))))))))))};Be.displayName="ShareMe24BrowseInternals";const Qe=({children:e,sessionId:t,actionElement:n,actionSurface:r,isDir:i})=>{const s=h.useData(),o=De.useRef(!1);return De.useEffect((()=>{if(!o.current)return"error"===s.status?(o.current=!0,void a.defaultEmitter$1.select(a.ON_LOADING_WRAPPER_DETECT_FAILURE).emit({sessionId:t,actionElement:n,actionSurface:r,isDir:i})):"loaded"===s.status?(o.current=!0,void a.defaultEmitter$1.select(a.ON_LOADING_WRAPPER_DETECT_SUCCESS).emit({sessionId:t,actionElement:n,actionSurface:r,isDir:i,isSharingBanned:s.accountMetadata.is_sharing_banned})):void 0}),[s.status,t,n,r,i]),De.useEffect((()=>()=>{o.current||(o.current=!0,a.defaultEmitter$1.select(a.ON_LOADING_WRAPPER_DETECT_CANCEL).emit({sessionId:t,actionElement:n,actionSurface:r,isDir:i}))}),[]),De.createElement(De.Fragment,null,e)};Qe.displayName="DataLoadingLogger";const We=e=>{switch(e){case"previews":return"previews";case"search":return"search_results_page";case"quick-view-search":return"search_quick_view";case"browse_screen":return"browse_screen";case"quick-view-browse":return"browse_quick_view";default:return`unknown_${e}`}};e.ShareMe24Browse=Ue}));
//# sourceMappingURL=c_shareme24_browse_integration_index.after-display.js-vfldCv9aV.map

//# debugId=f783f539-9947-3e75-b3fe-d421f515f526