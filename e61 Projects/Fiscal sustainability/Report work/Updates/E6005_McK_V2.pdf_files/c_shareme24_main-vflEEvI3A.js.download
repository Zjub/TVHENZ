!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="b6064a09-eda3-34ef-968b-8e1e2fc898ab")}catch(e){}}();
define(["exports","react","./e_file_viewer_static_scl_page_file","./c_chat_chat_constants","./c_over-quota_utils_use_get_plans","./c_over-quota_utils_oq_price_decrease_helper","./c_ui_contextual-nudge_campaign-contextual-nudge-section","./c_core_i18n","./e_data_modules_stormcrow","./c_browse_welcome_hub_lib_types","./c_common_components_layout","./c_utils_dsx_dsx-react","./c_content-member-list_internals_content-member-list","./c_inband-screen_internals_share-modal-share","./e_core_exception","./c_src_utils_initials","./c_over-quota_over-quota-sweep-blocking-modal_show_over_quota_modal_or_continue","./c_common_components_buttons","./c_settings-page_internals_settings-page-wrapper","./c_user_metadata_api","./c_dig-icons_assets_ui-icon_line_qr-code","./c_dig-icons_assets_ui-icon_line_settings","./c_dig-icons_assets_ui-icon_line_stacks","./c_dotlottie_common_chunk-B7OIQIGJ","./c_spectrum_util_raf_throttle","./c_api_v2_unauthed_client","./c_bem","./c_src_sink_index"],(function(e,t,a,n,o,i,r,s,l,c,d,u,g,m,p,_,E,f,S,y,C,b,v,h,L,k,A,T){"use strict";function I(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var n=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var $=I(t),M=function(e,t,a){if(a||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))},N=[0],w=new Map;function R(e,n){var o=void 0===n?{}:n,i=o.threshold,r=void 0===i?N:i,s=o.root,l=o.rootMargin,c=void 0===l?"0px":l,d=a.useSafeState(),u=d[0],g=d[1];return t.useEffect((function(){var t=e&&"current"in e?e.current:e;if(t){var a=!0,n=function(e){var t,a=null!==(t=e.root)&&void 0!==t?t:document,n=w.get(a);n||(n=new Map,w.set(a,n));var o=JSON.stringify([e.rootMargin,e.threshold]),i=n.get(o);if(!i){var r=new Map,s=new IntersectionObserver((function(e){return e.forEach((function(e){var t;return null===(t=r.get(e.target))||void 0===t?void 0:t.forEach((function(t){return setTimeout((function(){return t(e)}),0)}))}))}),e);i={observer:s,observe:function(e,t){var a=r.get(e);a||(a=new Set,r.set(e,a),s.observe(e)),a.add(t)},unobserve:function(e,t){var i=r.get(e);i&&(i.delete(t),i.size||(r.delete(e),s.unobserve(e),r.size||(s.disconnect(),n.delete(o),n.size||w.delete(a))))}},n.set(o,i)}return i}({root:s&&"current"in s?s.current:s,rootMargin:c,threshold:r}),o=function(e){a&&g(e)};return n.observe(t,o),function(){a=!1,n.unobserve(t,o)}}}),M([e,s,c],r,!0)),u}const x={".tag":"no_one"},O={".tag":"password"},P={".tag":"team"},D={".tag":"public"};const U={".tag":"viewer"},B={".tag":"editor"},V={".tag":"default"};a.injectInternalStyle("/static/metaserver/static/js/growth/ui/over-quota/over-quota-share-banner-component/over_quota_share_banner_component.module.out-vflEEG0ol.css",(e=>"._bannerSection_l7aro_1{margin-bottom:var(--dig-spacing__micro__medium);margin-top:var(--dig-spacing__micro__small)}"));const j="_bannerSection_l7aro_1";const F=({onUpgrade:e})=>{var t,n,r,s,l,c,d,u,g,m;const[p,_]=$.default.useState(!1),E=a.useExperimentVariant("end_state_web_overquota_restrictions"),f=E&&E.variant===a.Variant.V1,S="ON"===a.useExperimentVariant("overquota_glide_modal").variant,y=$.default.useRef(!1),C=(null==E?void 0:E.variant)?E.variant:a.Variant.OFF,{user:b}=a.useActiveUser(),{quotaUpsellInfo:v,isLoadingQuotaUpsellInfo:h,quotaUpsellInfoError:L}=a.useQuotaUpsellInfo(b,E.variant===a.Variant.OFF),k=!(E.isLoading||h||E.error||L),A=(null===(t=null==v?void 0:v.restrictions)||void 0===t?void 0:t.enforce_restrictions)||(null===(n=null==v?void 0:v.restrictions)||void 0===n?void 0:n.show_restrictions_warning),T=f&&A,I=(null===(l=null===(s=null===(r=null==v?void 0:v.quota)||void 0===r?void 0:r.allocation)||void 0===s?void 0:s.individual)||void 0===l?void 0:l.allocated)||0,M=(null===(c=null==v?void 0:v.quota)||void 0===c?void 0:c.used)||0,N=null===(d=null==v?void 0:v.restrictions)||void 0===d?void 0:d.overquota_start_time_utc_seconds,w=N?Date.now()/1e3-N:void 0,R=!!(null===(u=null==v?void 0:v.restrictions)||void 0===u?void 0:u.enforce_restrictions),x=a.getOverQuotaReason(null==v?void 0:v.overquota_reason),O=null!==(g=i.getOrganicOrChurnedFromString(x))&&void 0!==g?g:"unlabeled";if($.default.useEffect((()=>{k&&A&&[a.Variant.V1,a.Variant.CONTROL,a.Variant.HOLDOUT].includes(C)&&(a.logExposure({feature:"end_state_web_overquota_restrictions",variant:C}),a.logAdditionalExposureDetails(C,"share_modal_banner",v))}),[C,A,k,v]),$.default.useEffect((()=>{k&&T&&!y.current&&(a.UDCL.logEvent({class:"quota",action:"shown",object:"overquota_share_modal_banner",properties:{quotaLimit:I,quotaUsed:M,secondsOverquota:w,hardblocked:R,organicOrChurned:O}},{tags:{hardblocked:R?"true":"false",organicOrChurned:O}}),y.current=!0)}),[k,T,I,M,w,R,O]),!k)return null;if(!T)return null;const P=(null===(m=null==v?void 0:v.restrictions)||void 0===m?void 0:m.show_restrictions_warning)||!1,D=function(e,t){var a;return e?(null===(a=null==t?void 0:t.restrictions)||void 0===a?void 0:a.restrictions_start_time_utc_seconds)?o.SHARING_RESTRICTION_WARNING(o.getRestrictionsDateString(t.restrictions.restrictions_start_time_utc_seconds)):o.SHARING_RESTRICTION_WARNING_NO_DATE:o.SHARING_ENFORCE_RESTRICTIONS}(P,v);return $.default.createElement(a.Box,{className:j,"data-testid":"over-quota-share-banner-component"},$.default.createElement(a.Banner,{type:P?"warning":"alert",borderRadius:"Large"},$.default.createElement(a.Box,{display:"flex",justifyContent:"space-between",alignItems:"center"},$.default.createElement(a.Banner.Message,null,D),$.default.createElement(a.Banner.Actions,null,$.default.createElement(a.Button,{variant:"transparent",onClick:()=>{a.UDCL.logEvent({class:"quota",action:"select",object:"overquota_share_modal_banner",properties:{quotaLimit:I,quotaUsed:M,secondsOverquota:w,hardblocked:R,organicOrChurned:O,actionElement:"upgrade"}},{tags:{actionElement:"upgrade",hardblocked:R?"true":"false",organicOrChurned:O}}),S?(_(!0),a.openDoormanUpsellModal({modalVersion:"glide-upsell-modal-dp-only",trialCardsLocation:a.TrialCardsLocation.OVERQUOTA_SHARE_BANNER,reloadPageAfterPurchase:!0,onDisplayed:()=>{null==e||e()}})):(a.redirect("/out-of-space?_tk=oq_restrictions_modal"),null==e||e())},isLoading:p},o.UPGRADE)))))};F.displayName="OverquotaShareBannerComponent";const H=s.defineMessage({id:"UaJBfk",defaultMessage:"QR code for sharing"}),q=s.defineMessage({id:"ZFsp0l",defaultMessage:"Download"}),K=s.defineMessage({id:"E89n5D",defaultMessage:"Download QR code"}),G=s.defineMessage({id:"EQKjGC",defaultMessage:"Anyone with the code can view."}),Q=s.defineMessage({id:"J8vTeR",defaultMessage:"Team members with the code can view."}),W=s.defineMessage({id:"8JPLVJ",defaultMessage:"Manage link access"}),Y=s.defineMessage({id:"tllLrY",defaultMessage:"Only people invited can view."}),z=s.defineMessage({id:"bWq9cz",defaultMessage:"Couldn’t create QR code. You don’t have permission to create a QR code to this content."}),J=s.defineMessage({id:"tpMKHD",defaultMessage:"We can’t find this file anymore. Try checking activity or folder history to see what happened."}),X=s.defineMessage({id:"zGqflr",defaultMessage:"You can’t share until you verify your email address."}),Z=s.defineMessage({id:"zM/n79",defaultMessage:"Couldn’t create QR code. Please try again later."}),ee=s.defineMessage({id:"s2Zxdl",defaultMessage:"Couldn’t create QR code."});var te;!function(e){e.PATH_FORBIDDEN="path_forbidden",e.PATH_NOT_FOUND="path_not_found",e.EMAIL_NOT_VERIFIED="email_not_verified",e.SERVICE_UNAVAILABLE="service_unavailable",e.UNKNOWN="unknown"}(te||(te={}));const ae=e=>`data:image/png;base64,${e}`;a.injectInternalStyle("/static/metaserver/static/js/sharing/features/sharing_qr_code/get_qr_code_modal.module.out-vflNN1fVL.css",(e=>"._get-qr-code-modal_dbu8m_1>div{background-color:var(--dig-color__background__subtle);border:1px solid var(--dig-color__border__subtle)}._get-qr-code-modal-image_dbu8m_6{display:flex;width:100%}._get-qr-code-modal-spinner_dbu8m_11{align-items:center;aspect-ratio:1/1;display:flex;justify-content:center;width:100%}._get-qr-code-modal-body_dbu8m_19{padding-bottom:var(--spacing__unit--3);padding-top:calc(var(--spacing__unit--1)*6)}._get-qr-code-modal-filename_dbu8m_25{white-space:nowrap}@media (min-width:601px){._get-qr-code-modal-body_dbu8m_19{padding-top:var(--spacing__unit--3)}._get-qr-code-modal_dbu8m_1 button.dig-Modal-close-btn{display:none}}"));const ne=({base64QrCode:e})=>$.default.createElement("img",{"data-testid":"qr-code-modal-image",className:"_get-qr-code-modal-image_dbu8m_6",src:ae(e),alt:s.intl.formatMessage(H)});ne.displayName="GetQrCodeModalImage";const oe=()=>$.default.createElement("div",{className:"_get-qr-code-modal-spinner_dbu8m_11"},$.default.createElement(a.Spinner,{size:"medium"}));const ie=a.createApiv2Query({nsClient:function(e){return e.ns("sharing_qr_code")},rpc:"get_qr_code"}),re=()=>{var e;const t="dark"===(null===(e=a.useTheme())||void 0===e?void 0:e.mode);return $.default.createElement($.default.Fragment,null,$.default.createElement(a.Box,{padding:"Micro XLarge",marginTop:"Micro Small",borderWidth:"1",borderColor:"Border Subtle",borderStyle:"Solid",backgroundColor:t?"Secondary Surface - State 1":"Background Base",borderRadius:"XLarge"},$.default.createElement(oe,null)),$.default.createElement(a.Box,{marginTop:"Micro Large"},$.default.createElement(a.Button,{size:"large",variant:"primary",fullWidth:!0,"data-uxa-log":"download_qr_code_modal_button","aria-label":s.intl.formatMessage(K),disabled:!0,autoFocus:!0},s.intl.formatMessage(q)),$.default.createElement(a.Box,{marginTop:"Micro Large"},$.default.createElement(a.Skeleton.Text,null)," ",$.default.createElement(a.Skeleton.Text,null))))};re.displayName="GetQrCodeLoading";const se=({objectIdentifier:e,user:t,onSettingsClick:o,qrCodeResponse:i,fileName:r,filePath:l})=>{var c,d;const u=null!==(c=i.qrcode)&&void 0!==c?c:"",g=i.effective_audience,m=$.default.useCallback(((o,i)=>{const r=a.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,s=n.get_browser_info(),c=e.fileId;a.ShareTibEventLogger.log(t.id,o,r,{file_id:c,fq_path:l,is_folder:"file"!==e[".tag"],browser:s.browser,browser_version:s.version,...i})}),[e,l,t.id]);$.default.useEffect((()=>{const e=i.link_url;if(e){const t=a.parseLink(e),n=t.doesContainShmodelLink?a.ShareTibEventLogger.get_shmodel_extra_for_logging(void 0,a.getCleanedSharingUrl(t)):a.ShareTibEventLogger.get_scl_extra_for_logging(void 0,a.getCleanedSharingUrl(t)),o={sender_trackey:t.searchParams.get("st"),...n};m(a.TiburonEventName.CreateQrCode,o)}}),[m,i.link_url]);const p="dark"===(null===(d=a.useTheme())||void 0===d?void 0:d.mode),_=(e=>{switch(e){case"public":return G;case"team":return Q;case"no_one":return Y;default:return""}})(g);return $.default.createElement($.default.Fragment,null,$.default.createElement(a.Box,{padding:"Micro XLarge",marginTop:"Micro Small",borderWidth:"1",borderColor:"Border Subtle",borderStyle:"Solid",backgroundColor:p?"Secondary Surface - State 1":"Background Base",borderRadius:"XLarge"},$.default.createElement(ne,{base64QrCode:u})),$.default.createElement(a.Box,{marginTop:"Micro Large"},$.default.createElement(a.Button,{size:"large",variant:"primary",onClick:e=>{e.preventDefault(),((e,t)=>{const a=document.createElement("a");a.href=ae(e),a.download=`${t}_QR.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a)})(u,r)},fullWidth:!0,"data-uxa-log":"download_qr_code_modal_button","aria-label":s.intl.formatMessage(K),autoFocus:!0},s.intl.formatMessage(q)),$.default.createElement(a.Box,{marginTop:"Micro Large"},_?$.default.createElement(a.Text,null,s.intl.formatMessage(_)):null,o?$.default.createElement($.default.Fragment,null," ",$.default.createElement(a.Link,{hasNoUnderline:!0,href:"#",onClick:e=>{e.preventDefault(),o()},"data-uxa-log":"settings_qr_code_modal_button",display:"inline"},s.intl.formatMessage(W))):null)))};se.displayName="GetQrCodeLoaded";const le=e=>{const{user:t,onGetQrCodeError:n,objectIdentifier:o,fileName:i,filePath:r}=e,l=(e=>{const t=ie.useQuery({apiArg:{read_path:e}},{staleTime:0});return $.useMemo((()=>t?t.isLoading?{isLoading:!0}:t.isError?{isLoading:!1,isError:!0,error:t.error.appError}:{output:t.data.apiData,isLoading:!1,isError:!1}:{isLoading:!0}),[t])})(a.getContentIdOrPathFromObjectIdentifier(o)),c=$.default.useRef(!1);return $.default.useEffect((()=>{var e;if(!1===c.current&&!l.isLoading&&(void 0===t||l.isError||void 0===l.output||void 0===l.output.qrcode||""===l.output.qrcode)){c.current=!0;const t=l.isError?null===(e=l.error)||void 0===e?void 0:e[".tag"]:void 0;a.Snackbar.warn(s.intl.formatMessage((e=>{switch(e){case te.PATH_FORBIDDEN:return z;case te.PATH_NOT_FOUND:return J;case te.EMAIL_NOT_VERIFIED:return X;case te.SERVICE_UNAVAILABLE:return Z;default:return ee}})(t))),null==n||n()}}),[n,t,l]),l.isLoading?$.default.createElement(re,null):void 0===t||l.isError||void 0===l.output||void 0===l.output.qrcode||""===l.output.qrcode?null:$.default.createElement(se,{...e,user:t,qrCodeResponse:l.output,fileName:i,filePath:r})};le.displayName="GetQrCodeInner";const ce=e=>{const{user:t,isLoading:n}=a.useActiveUser();return n?$.default.createElement(re,null):$.default.createElement(le,{...e,user:t})};ce.displayName="GetQrCode";var de;!function(e){e.MAIN="main",e.QRCODE="qrcode",e.INBAND="inband",e.MANAGE_ACCESS="manage_access",e.COPY_LINK="copy_link",e.SETTINGS="settings",e.ERROR="error"}(de||(de={}));const ue=e=>{const t=$.useRef(null),[n,o]=$.useState(-1),i=c.usePlatform()===c.Platforms.DESKTOP;$.useEffect((()=>{e.isOpen&&t.current&&"inband"!==e.currentScreen&&t.current.focus()}),[e.isOpen,e.currentScreen]);const r=e.onEscape,s=$.useCallback((e=>{if(!t.current)return;if("Shift"===e.key)return;if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)){const t=e.target;t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.contentEditable||t.isContentEditable)||(e.preventDefault(),e.nativeEvent.stopImmediatePropagation())}return"Escape"===e.key?(r(e),e.preventDefault(),void e.nativeEvent.stopImmediatePropagation()):void 0}),[r,n,o]),l="anchored_v1"===e.displayMode?e.onAnchorInvalid:void 0,u=R("anchored_v1"===e.displayMode?t:null,{threshold:[.99]});$.useLayoutEffect((()=>{u&&!u.isIntersecting&&l&&l()}),[u,null==u?void 0:u.isIntersecting,l]);const g="anchored_v1"===e.displayMode?e.anchorRef:null;if($.useEffect((()=>{if("anchored_v1"!==e.displayMode||!l||null===g)return;const t=g.current;if(!t||"object"!=typeof t||!("nodeType"in t))return;const a=new MutationObserver((e=>{var a,n;for(const o of e)if("childList"===o.type)for(const e of Array.from(o.removedNodes))if(e===t||(null===(n=(a=e).contains)||void 0===n?void 0:n.call(a,t)))return void l()}));return a.observe(document.body,{childList:!0,subtree:!0}),()=>{a.disconnect()}}),[e.displayMode,l,g]),"centered_v1"===e.displayMode){const n=e.currentScreen===de.SETTINGS?500:e.currentScreen===de.COPY_LINK?400:380;return $.createElement(a.Modal,{open:e.isOpen,width:n,ariaHideApp:!1,onRequestClose:e.onClickOutside,overlayStyles:i?{overflow:"visible"}:void 0,contentStyles:i?{borderRadius:"unset"}:void 0,ref:t,isCentered:!0},$.createElement(c.FocusLock,{group:"share-modal"},$.createElement("div",{"data-testid":"shareme24-modal","data-uxa-log":"sm24-modal","data-uxa-interactions":"shown",className:a.cx(d.outerWrapper,{[d.outerWrapperDesktop]:i}),ref:e.modalCallbackRef,style:{width:n}},null!==e.header&&$.createElement(a.Modal.Header,{className:d.headerSection},e.header),$.createElement(a.Modal.Body,{className:a.cx(d.modalInnerWrapper,{[d.modalInnerWrapperMainExit]:e.isExitingMainToQr,[d.modalInnerWrapperSettings]:e.currentScreen===de.SETTINGS}),onAnimationEnd:e.onOverlayOrModalAnimationEnd},e.children))))}if("drawer"===e.displayMode){const t="main"===e.currentScreen,n=t?"auto":"100%";return $.createElement(a.Drawer.ModalDrawer,{onRequestClose:e.onClickOutside,"aria-label":"sm24-drawer",isOpen:e.isOpen,alignment:"bottom",height:n,className:t?d.roundedCorner:void 0,"data-testid":"shareme24-drawer",shouldAnimate:!0,hasScrollLock:e.hasScrollLock},$.createElement(c.FocusLock,{group:"share-modal"},$.createElement("div",{className:a.cx(d.drawerOuterWrapper)},$.createElement(a.Drawer.Container,null,t?$.createElement("div",{className:d.handle}):void 0,$.createElement(a.Drawer.Header,{className:d.drawerHeader},$.createElement(a.Drawer.Layout,null,$.createElement(a.Drawer.LayoutItem,{width:"fill"},$.createElement(a.Drawer.Layout,null,e.header)))),$.createElement(a.Drawer.Body,{className:a.cx(d.modalInnerWrapper,d.drawerBody,{[d.drawerBodySettings]:e.currentScreen===de.SETTINGS,[d.modalInnerWrapperMainExit]:e.isExitingMainToQr}),onAnimationEnd:e.onOverlayOrModalAnimationEnd},e.children)))))}return $.createElement(a.ClickOutside,{className:d.clickOutside,isActive:e.isOpen,onClickOutside:e.onClickOutside,shouldClickOutsideWhenDefaultPrevented:!1,"data-uxa-log":"sm24-clickaway","data-uxa-interactions":"click"},$.createElement(a.Overlay,{className:a.cx(d.overlay,{[d.overlayMainExit]:e.isExitingMainToQr}),offsetDistance:e.offsetDistance,anchorRef:e.anchorRef,placement:e.placement,auto:!0,onAnimationEnd:e.onOverlayOrModalAnimationEnd,elementResize:!0},$.createElement(c.FocusLock,{group:"share-modal"},$.createElement("div",{"data-testid":"shareme24-modal",className:a.cx(d.outerWrapper),style:{width:e.currentScreen===de.SETTINGS?500:e.currentScreen===de.COPY_LINK?400:380},onKeyDown:s,ref:a=>{t&&(t.current=a),"function"==typeof e.modalCallbackRef&&e.modalCallbackRef(a)},"data-uxa-log":"sm24-modal","data-uxa-interactions":"shown",tabIndex:0},null!==e.header&&$.createElement(a.Modal.Header,{className:d.headerSection},e.header),$.createElement(a.Modal.Body,{className:a.cx(d.modalInnerWrapper,{[d.modalInnerWrapperMainExit]:e.isExitingMainToQr,[d.modalInnerWrapperSettings]:e.currentScreen===de.SETTINGS}),onAnimationEnd:e.onOverlayOrModalAnimationEnd},e.children)))))};ue.displayName="Wrapper";const ge=({styleName:e,...t})=>$.createElement("div",{className:`${d.buttonRow} ${e}`,"aria-hidden":t.hidden,...t},t.children);ge.displayName="ButtonRow";const me=({styleName:e,...t})=>$.createElement("div",{className:`${d.buttonRowButtonWrapper} ${e}`,"aria-hidden":t.hidden,...t},t.children);me.displayName="ButtonRowButtonWrapper";const pe="SHARING_BANNED_MODAL",_e=e=>{const[n,o]=t.useState(!0),i=s.intl.formatMessage({id:"sHjsEB",defaultMessage:"Couldn’t complete share"}),r=s.intl.formatMessage({id:"3Ob1gB",defaultMessage:"We’ve interrupted your sharing activity. For details or to contact support, read our <link>help center article.</link>"},{link:e=>$.default.createElement(a.Button,{variant:"transparent",href:a.ABUSE_HELP_ARTICLE_LINK,target:"_blank",hasNoUnderline:!0},e)});return $.default.createElement(a.Modal,{open:n,isCentered:!0,withCloseButton:"Close",onRequestClose:()=>o(!1),onAfterClose:e.onAfterClose,"aria-labelledby":"sharing-banned-modal-title"},$.default.createElement(a.Modal.Header,{hasBottomSpacing:"title-standard"},$.default.createElement(a.Modal.Title,{id:"sharing-banned-modal-title"},i)),$.default.createElement(a.Modal.Body,null,r),$.default.createElement(a.Modal.Footer,null))};_e.displayName="SharingBannedModal";const Ee=e=>{(new Image).src=e},fe=e=>({access_type:{".tag":"owner"},user:{account_id:e.account_id,email:e.email,display_name:e.display_name,same_team:!0,disabled:!1}}),Se=Symbol("ON_INITIAL_LOAD_START"),ye=Symbol("ON_INITIAL_LOAD_FAILURE"),Ce=Symbol("ON_INITIAL_LOAD_CANCEL"),be=Symbol("ON_INITIAL_LOAD_SUCCESS"),ve=Symbol("ON_FOLDER_ALREADY_SHARED"),he=Symbol("ON_TEST_INITIAL_LOAD_START"),Le=Symbol("ON_TEST_INITIAL_LOAD_SUCCESS"),ke=Symbol("ON_TEST_INITIAL_LOAD_CANCEL"),Ae=Symbol("ON_TEST_INITIAL_LOAD_FAILURE"),Te=Symbol("ON_TEST_REFRESH_LOAD_START"),Ie=Symbol("ON_TEST_REFRESH_LOAD_SUCCESS"),$e=Symbol("ON_TEST_REFRESH_LOAD_CANCEL"),Me=Symbol("ON_TEST_REFRESH_LOAD_FAILURE"),Ne=Symbol("ON_DOUBLE_READ_DIFF"),{useEmitter:we,defaultEmitter:Re}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),o=t(a.Context$5),i=t(a.Context$6),r=t(a.Context$7),s=t(m.Context),l={...a.getTags$4(n),...a.getTags$5(o),...a.getTags$6(i),...a.getTags$7(r)},c={...a.getProperties$4(n),...a.getProperties$5(o),...a.getProperties$6(i),...a.getProperties$7(r)};if(e.key!==Se){if(e.key===ye){let t="none";if("response"in e.payload.error)try{const a=e.payload.error.response.error;".tag"in a&&(t=a[".tag"]||"none")}catch(e){t="loggingFailure"}const n={...l,errorType:e.payload.error.type,errorTag:t,objMetadataNewApiVariant:e.payload.objMetadataNewApiVariant};return a.UDCL.logEnd(a.PAP_Load_ShareModal({eventState:"failed",...c}),{key:s,tags:n}),void a.UDCL.logEnd("ops.sm24.initial_data_load",{eventState:"failed",key:s,tags:n})}if(e.key===Ce){const t={...l,objMetadataNewApiVariant:e.payload.objMetadataNewApiVariant};return a.UDCL.logEnd(a.PAP_Load_ShareModal({eventState:"canceled",...c}),{eventState:"canceled",key:s,tags:t}),void a.UDCL.logEnd("ops.sm24.initial_data_load",{eventState:"canceled",key:s,tags:t})}if(e.key===be){const t={...l,objMetadataNewApiVariant:e.payload.objMetadataNewApiVariant};return a.UDCL.logEnd(a.PAP_Load_ShareModal({eventState:"success",...c}),{key:s,tags:t}),void a.UDCL.logEnd("ops.sm24.initial_data_load",{eventState:"success",key:s,tags:t})}if(e.key!==ve)if(e.key!==he)if(e.key!==Le)if(e.key!==ke)if(e.key!==Ae)if(e.key!==Te)if(e.key!==Ie)if(e.key!==$e)if(e.key!==Me){if(e.key===Ne){const t=e.payload.diffs.reduce(((e,t)=>({...e,[`diff_${t.field}`]:"true"})),{});a.UDCL.logEvent("ops.sm24.double_read_diff",{tags:t,detail:{fileId:e.payload.fileId,diffs:e.payload.diffs}})}}else{let t="none";if("response"in e.payload.error)try{const a=e.payload.error.response;".tag"in a&&(t=a[".tag"]||"none")}catch(e){t="loggingFailure"}a.UDCL.logEnd("ops.sm24.test_refresh_data_load",{eventState:"failed",key:s,tags:{...l,errorType:e.payload.error.type,errorTag:t}})}else a.UDCL.logEnd("ops.sm24.test_refresh_data_load",{eventState:"canceled",key:s,tags:l});else a.UDCL.logEnd("ops.sm24.test_refresh_data_load",{eventState:"success",key:s,tags:l});else a.UDCL.logStart("ops.sm24.test_refresh_data_load",{key:s,tags:l});else{let t="none";if("response"in e.payload.error)try{const a=e.payload.error.response;".tag"in a&&(t=a[".tag"]||"none")}catch(e){t="loggingFailure"}a.UDCL.logEnd("ops.sm24.test_initial_data_load",{eventState:"failed",key:s,tags:{...l,errorType:e.payload.error.type,errorTag:t}})}else a.UDCL.logEnd("ops.sm24.test_initial_data_load",{eventState:"canceled",key:s,tags:l});else a.UDCL.logEnd("ops.sm24.test_initial_data_load",{eventState:"success",key:s,tags:l});else a.UDCL.logStart("ops.sm24.test_initial_data_load",{key:s,tags:l});else a.UDCL.logEvent("ops.sm24.already_shared",{tags:l})}else{const t={...l,objMetadataNewApiVariant:e.payload.objMetadataNewApiVariant};a.UDCL.logStart("ops.sm24.initial_data_load",{key:s,tags:t})}})),xe=e=>{const t=we(),{isNonUserRelativeContext:n}=a.useSharingApiContext();return $.useCallback((async()=>{const o=e.$nonce.get(),i=e.$options.get(),r=e.$state.get();let s=i.objectIdentifier;"loaded"===r.status&&(s=r.objectIdentifier);const c=i.objMetadataNewApiVariant,d="V1"===c&&s.fileId,u=!d,g="ON"===c&&s.fileId;t.select(Se).emit({objMetadataNewApiVariant:c});const m=a=>{e.$state.set({status:"error",errorType:"INITIAL_LOAD_ERROR",loadError:a}),t.select(ye).emit({error:a,objMetadataNewApiVariant:c})},E=await a.getSharingApiv2ResponseWithErrors(a.sharingPrefsPackage.fetchQuery(l.queryClient,{})),f=await a.getSharingApiv2ResponseWithErrors(a.sharingAccountInfoPackage.fetchQuery(l.queryClient,{},{staleTime:18e5}));let S,y,C,b;if(d?y=await a.getSharingApiv2ResponseWithErrors(a.sharingObjectMetadataPackage.fetchQuery(l.queryClient,{apiArg:{file_id:s.fileId},pkgArg:{isNonUserRelativeContext:n}},{staleTime:3e5})):S=await l.queryClient.fetchQuery(["object-metadata",i.objectIdentifier],(()=>_.getSharingObjectMetadata(s,n))),g&&(t.select(he).emit(null),C=await a.getSharingApiv2ResponseWithErrors(a.sharingObjectMetadataPackage.fetchQuery(l.queryClient,{apiArg:{file_id:s.fileId},pkgArg:{isNonUserRelativeContext:n}},{staleTime:3e5})),"SUCCESS"===C.status?t.select(Le).emit(null):"ERROR"===C.status?t.select(Ae).emit({error:{type:"METADATA_ERROR_V2",response:C.error}}):t.select(Ae).emit({error:{type:"METADATA_FATAL_V2",response:{status:a.Status$1.FATAL,error:C}}})),o!==e.$nonce.get())return t.select(Ce).emit({objMetadataNewApiVariant:c}),void(g&&t.select(ke).emit(null));if(u){if(!S)return void m({type:"OTHER"});if("SUCCESS"!==S.status)return void("ERROR"===S.status?(p.reportStack("SM24 initial data loader error",{severity:p.SEVERITY.NONCRITICAL,tags:["sm24_initial_data_loader_error_V1"],exc_extra:{file_id:s.fileId,error:S},silent:!1}),m({type:"METADATA_ERROR",response:S})):(p.reportStack("SM24 initial data loader error",{severity:p.SEVERITY.NONCRITICAL,tags:["sm24_initial_data_loader_fatal_V1"],exc_extra:{file_id:s.fileId,error:S},silent:!1}),m({type:"METADATA_FATAL",response:S})));b=S.output}else{if(!y)return void m({type:"OTHER"});if("SUCCESS"!==y.status)return void("ERROR"===y.status?(p.reportStack("SM24 initial data loader error",{severity:p.SEVERITY.NONCRITICAL,tags:["sm24_initial_data_loader_error_V2"],exc_extra:{file_id:s.fileId,error:y},silent:!1}),m({type:"METADATA_ERROR_V2",response:y})):(p.reportStack("SM24 initial data loader error",{severity:p.SEVERITY.NONCRITICAL,tags:["sm24_initial_data_loader_fatal_V2"],exc_extra:{file_id:s.fileId,error:y},silent:!1}),m({type:"METADATA_FATAL_V2",response:y})));b=y.output}if(g&&"SUCCESS"===(null==C?void 0:C.status)){const e=a.normalizeNewApiMetadata(C.output),n=a.normalizeOldApiMetadata(b),{redactedDiffs:o,originalDiffs:i}=a.diffNormalizedMetadata(n,e);if(o.length>0){const e=C.output.common_metadata.file_id;if(t.select(Ne).emit({fileId:e,diffs:o}),i.length>0){const t=["sm24_metadata_diff",...i.map((e=>e.field)).map((e=>`diff_field_${e}`))];p.reportStack("SM24 metadata diff found",{severity:p.SEVERITY.NONCRITICAL,tags:t,exc_extra:{file_id:e,original_diffs:i},silent:!0})}}}if("SUCCESS"!==f.status||"SUCCESS"!==E.status)return void("SUCCESS"!==E.status?"ERROR"===E.status?m({type:"SHARING_PREFS_ERROR",response:E}):m({type:"SHARING_PREFS_FATAL",response:E}):"SUCCESS"!==f.status?m({type:"SHARING_ACCOUNT_INFO_ERROR"}):m({type:"OTHER"}));let v=s;"file_folder"===s[".tag"]&&a.getIsSharedFolder(b)&&(v={".tag":"shared_folder",sharedFolderId:a.getSharedFolderId(b),fileId:s.fileId}),e.$state.set({status:"loaded",objectIdentifier:v,memberActionsInProgress:{},memberAccountIdsAlreadyFetched:{},accountMetadata:f.output,memberAccounts:{},objectMetadata:b,sharingPrefs:E.output}),t.select(be).emit({objMetadataNewApiVariant:c})}),[e,t])},Oe=e=>{const t=(e=>$.useCallback((t=>{(e.$options.get().onRefreshError||(()=>{}))(t)}),[e]))(e),{isNonUserRelativeContext:n}=a.useSharingApiContext(),o=we();return $.useCallback((async()=>{const i=e.$state.get();if("loaded"!==i.status)return;const r=e.$nonce.get(),s=e.$state.get(),c=e.$options.get().objMetadataNewApiVariant,d="V1"===c&&i.objectIdentifier.fileId,u=!d,g="ON"===c&&i.objectIdentifier.fileId;let m,p,E,f;if(d?p=await a.getSharingApiv2ResponseWithErrors(a.sharingObjectMetadataPackage.fetchQuery(l.queryClient,{apiArg:{file_id:i.objectIdentifier.fileId},pkgArg:{isNonUserRelativeContext:n}},{staleTime:3e5})):m=await _.getSharingObjectMetadata(i.objectIdentifier,n),g&&(o.select(Te).emit(null),E=await a.getSharingApiv2ResponseWithErrors(a.sharingObjectMetadataPackage.fetchQuery(l.queryClient,{apiArg:{file_id:i.objectIdentifier.fileId},pkgArg:{isNonUserRelativeContext:n}},{staleTime:3e5})),"SUCCESS"===E.status?o.select(Ie).emit(null):"ERROR"===E.status?o.select(Me).emit({error:{type:"METADATA_ERROR_V2",response:E.error}}):o.select(Me).emit({error:{type:"METADATA_FATAL_V2",response:{status:a.Status$1.FATAL,error:E}}})),e.$nonce.get()!==r||"loaded"!==s.status)return null;if(u){if(!m)return void t({type:"OTHER"});if("ERROR"===m.status)return t({type:"METADATA_ERROR",response:m}),void e.$state.set({status:"error",errorType:"REFRESH_LOAD_ERROR",loadError:{type:"METADATA_ERROR",response:m}});if("FATAL"===m.status)return t({type:"FATAL",response:m}),void e.$state.set({status:"error",errorType:"REFRESH_LOAD_ERROR",loadError:{type:"FATAL",response:m}});f=m.output}else{if(!p)return void t({type:"OTHER"});if("ERROR"===p.status)return t({type:"METADATA_ERROR_V2",response:p}),void e.$state.set({status:"error",errorType:"REFRESH_LOAD_ERROR",loadError:{type:"METADATA_ERROR_V2",response:p}});if("FATAL"===p.status)return t({type:"FATAL",response:p}),void e.$state.set({status:"error",errorType:"REFRESH_LOAD_ERROR",loadError:{type:"FATAL",response:p}});f=p.output}let S=s.objectIdentifier;return"file_folder"===s.objectIdentifier[".tag"]&&a.getIsSharedFolder(f)&&(S={".tag":"shared_folder",sharedFolderId:a.getSharedFolderId(f),fileId:s.objectIdentifier.fileId}),e.$state.set({...s,objectMetadata:f,objectIdentifier:S}),null}),[e,t,o])},Pe=e=>{const t=xe(e),{variant:n,isLoading:o}=a.useExperimentVariant("sm24_obj_metadata_new_api"),i=!o,[r,s]=$.useState(null);$.useEffect((()=>{const o=null===(l=e.$options.get()).sessionId?null:"file"===l.objectIdentifier[".tag"]?`file:${l.sessionId}:${a.getContentIdOrPathFromObjectIdentifier(l.objectIdentifier)}`:"file_folder"===l.objectIdentifier[".tag"]?`folder:${l.sessionId}:${a.getContentIdOrPathFromObjectIdentifier(l.objectIdentifier)}`:`shared_folder:${l.sessionId}:${a.getContentIdOrPathFromObjectIdentifier(l.objectIdentifier)}`;var l;if(null===o)return null!==r&&s(null),void("unloaded"!==e.$state.get().status&&u.batch((()=>{e.$nonce.set(e.$nonce.get()+1),e.$state.set({status:"unloaded"})})));i&&(o===r&&"unloaded"!==e.$state.get().status||(u.batch((()=>{e.$nonce.set(e.$nonce.get()+1),e.$state.set({status:"loading"})})),s(o),e.$options.set({...e.$options.get(),objMetadataNewApiVariant:n}),a.logExposure({feature:"sm24_obj_metadata_new_api",variant:n}),t()))}))},De=e=>{const t=e.$state.get(),{user:n,isLoading:o}=a.useActiveUser(),i="loaded"===t.status&&!a.getIsLinkOnlyMode(t.objectMetadata)&&(a.getCanInvite(t.objectMetadata,m.VIEWER)||a.getCanInvite(t.objectMetadata,m.EDITOR)),r=e.$options.get().objectIdentifier;$.useEffect((()=>{i&&!o&&n&&(async(e,t)=>{a.prefetchListObjectMembersData(t),g.prefetchListSharedLinks(t),"file"===t[".tag"]&&a.prefetchSeenStateInfoData(t.fileId);const n=await a.fetchObjectMembers(t,!0);if(n){const{groups:t,users:a,invitees:o}={...n};0===a.length&&0===t.length&&0===o.length&&e&&(n.users=[fe(e)]);const i=n.users.map((e=>e.user.account_id)),r=await g.getAccountBatch(i);if("SUCCESS"===r.status){const t=Object.values(r.output),a=t.find((t=>t.account_id===(null==e?void 0:e.account_id)));(null==a?void 0:a.profile_photo_url)&&Ee(a.profile_photo_url),t.slice(0,2).forEach((e=>{e.profile_photo_url&&Ee(e.profile_photo_url)}))}}})(n,r)}),[i,o,n,r])},Ue=e=>{const t=Oe(e),a=xe(e),n=(e=>$.useCallback((t=>{const a=e.$state.get();"loaded"===a.status&&e.$state.set({...a,objectIdentifier:t})}),[e]))(e),o=u.useStore(e.$state);return $.useMemo((()=>({...o,refreshObjectMetadata:t,refreshModal:a,onObjectIdentifierChanged:n})),[o,t,a,n])},Be=e=>{const t=(e=>u.useInitStore(e,(()=>({$nonce:u.store(0),$options:u.store(e),$state:u.store({status:"unloaded"})}))))(e);return Pe(t),De(t),(e=>{$.useEffect((()=>()=>{u.batch((()=>{e.$nonce.set(e.$nonce.get()+1),e.$state.set({status:"unloaded"})}))}),[])})(t),Ue(t)},Ve=({children:e,...t})=>{const a=Be(t);return $.createElement(l.QueryClientProvider,{client:l.queryClient},$.createElement($.Fragment,null,e(a)))};Ve.displayName="ShareModalDataLoader";const je=$.createContext({status:"unloaded"}),Fe=({children:e,...t})=>$.createElement(Ve,{...t},(t=>$.createElement(je.Provider,{value:t},e)));Fe.displayName="Provider";const He=()=>$.useContext(je),qe=Symbol("ON_CLICK_PROGRESSIVE"),Ke=Symbol("ON_MOUSE_ENTER_PROGRESSIVE"),Ge=Symbol("ON_MOUSE_LEAVE_PROGRESSIVE"),{useEmitter:Qe,defaultEmitter:We}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),o=t(a.Context$5),i=t(a.Context$6),r=t(a.Context$7),s={...a.getTags$4(n),...a.getTags$5(o),...a.getTags$6(i),...a.getTags$7(r)},l={...a.getProperties$4(n),...a.getProperties$5(o),...a.getProperties$6(i),...a.getProperties$7(r)};if(e.key===qe)return a.UDCL.logEvent(m.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"copy_link",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...s,action:"copy_link"}}),void a.UDCL.logEvent(S.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"copy_link",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!0}),{tags:{...s,action:"copy_link"}});if(e.key!==Ke){if(e.key!==Ge)return a.exhausts(e,void 0);a.UDCL.logEvent(S.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"copy_link",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!1}),{tags:{...s,action:"copy_link"}})}else a.UDCL.logEvent(S.PAP_Hover_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"copy_link"}),{tags:{...s,action:"copy_link"}})})),Ye=e=>{const{objectMetadata:t,accountMetadata:n,onCopyLinkButtonClicked:o,componentViewTime:i}=e,r=a.isNewApiMetadata(t),[l,c]=$.useState(!1),[d,u]=$.useState(!1),[g,m]=$.useState(0),p=$.useRef(null),E=Qe(),S=_.isTmrMember(n),y=a.getCanCreateLink(t,a.VIEWER,S),C=a.getCanCreateLink(t,a.EDITOR,S)||y,b=$.useCallback((()=>{const e=d?Date.now()-g:void 0,t=Date.now()-i;E.select(qe).emit({dwellTime:e,timeSinceView:t}),o()}),[i,E,d,o,g]),v=$.useCallback((()=>{m(Date.now()),u(!0),E.select(Ke).emit(null),c(!0)}),[E]),h=$.useCallback((()=>{const e=d?Date.now()-g:void 0;u(!1),E.select(Ge).emit({dwellTime:e}),c(!1)}),[E,d,g]),L=$.useMemo((()=>!!r&&!C),[r,C]);return $.createElement($.Fragment,null,$.createElement(f.ButtonWrapper,{ref:p,onMouseEnter:v,onMouseLeave:h,"data-uxa-log":"sharing-lego-copy_link-button.loaded","data-uxa-interactions":"shown click"},$.createElement(f.VerticalButton,{onClick:b,disabled:L,"data-testid":"copy-link-entry-button"},$.createElement(f.ButtonIconContainer,null,$.createElement(a.UIIcon,{src:a.LinkLine,size:"medium","data-testid":"copy-link-entry-button-icon"})),$.createElement(f.Spacer,null),$.createElement(f.ButtonInnerColumn,null,$.createElement(f.ButtonTitle,{content:(k=s.intl,k.formatMessage({id:"1xxmJZ",defaultMessage:"Copy link"}))})))),(()=>{let e=null;return r&&!C&&(e=$.createElement(a.Text,null,s.intl.formatMessage({id:"wVml0u",defaultMessage:"You don’t have permission to copy this link."}))),e?$.createElement(a.Tooltip.Control,{open:l,placement:"top",auto:!0,triggerRef:p,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1)},e):null})());var k};Ye.displayName="CopyLinkEntryButtonInner";const ze=e=>{const{objectIdentifier:t,onCopyLinkButtonClicked:n,componentViewTime:o}=e,i=_.useSharingObjectMetadata(t.fileId),r=_.useSharingAccountInfo(),s=i.isLoading,l=!i.isLoading&&i.isError,c=s||l?void 0:i.output,d=r.isLoading,u=!r.isLoading&&r.isError,g=d||u?void 0:r.output;return s||d?$.createElement(f.ButtonWrapper,{"data-uxa-log":"sharing-lego-copy-link-button.loading","data-uxa-interactions":"shown click"},$.createElement(f.VerticalButton,{disabled:!0},$.createElement(f.ButtonIconContainer,null,$.createElement(a.UIIcon,{src:a.LinkLine,size:"medium"})),$.createElement(f.Spacer,null),$.createElement(f.ButtonInnerColumn,null,$.createElement(a.Skeleton.Text,{size:"small",style:{marginTop:22}})))):c&&g?$.createElement(Ye,{accountMetadata:g,objectMetadata:c,onCopyLinkButtonClicked:n,componentViewTime:o}):null};ze.displayName="CopyLinkEntryButton";const Je=Symbol("ON_CLICK"),Xe=Symbol("ON_MOUSE_ENTER"),Ze=Symbol("ON_MOUSE_LEAVE"),{useEmitter:et,defaultEmitter:tt}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),o=t(a.Context$5),i=t(a.Context$6),r=t(a.Context$7),s={...a.getTags$4(n),...a.getTags$5(o),...a.getTags$6(i),...a.getTags$7(r)},l={...a.getProperties$4(n),...a.getProperties$5(o),...a.getProperties$6(i),...a.getProperties$7(r)};if(e.key===Je)return a.UDCL.logEvent(m.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"copy_link",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...s,action:"copy_link"}}),void a.UDCL.logEvent(S.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"copy_link",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!0}),{tags:{...s,action:"copy_link"}});e.key!==Xe?e.key!==Ze||a.UDCL.logEvent(S.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"copy_link",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!1}),{tags:{...s,action:"copy_link"}}):a.UDCL.logEvent(S.PAP_Hover_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"copy_link"}),{tags:{...s,action:"copy_link"}})})),at=({store:e,objectMetadata:t,isSimpleCopyLinkPending:n=!1})=>{const o=!!t&&a.isNewApiMetadata(t),[i,r]=$.useState(!1),l=$.useRef(null),c=et(),d=!!t&&a.getCanCreateLink(t,a.VIEWER,!1),u=!!t&&a.getCanCreateLink(t,a.EDITOR,!1),g=d||u,m=$.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0,a=Date.now()-e.$componentViewTime.get();c.select(Je).emit({dwellTime:t,timeSinceView:a}),e.$isHovered.set(!1),e.$props.get().onClickCopyLinkButton()}),[c,e]),p=$.useCallback((()=>{c.select(Xe).emit(null),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now()),r(!0)}),[c,e]),_=$.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;c.select(Ze).emit({dwellTime:t}),e.$isHovered.set(!1),e.$hoverStartTime.set(0),r(!1)}),[c,e]);$.useEffect((()=>{e.$componentViewTime.set(Date.now())}),[e]);const E=n||!!o&&!g;return $.createElement($.Fragment,null,$.createElement(f.ButtonWrapper,{ref:l,onMouseEnter:p,onMouseLeave:_,"data-uxa-log":"sm24-copy_link-button.loaded","data-uxa-interactions":"shown click"},$.createElement(f.VerticalButton,{onClick:m,disabled:E,"data-testid":"copy-link-button"},$.createElement(f.ButtonIconContainer,null,$.createElement(a.UIIcon,{src:a.LinkLine,size:"medium","data-testid":"copy-link-icon"})),$.createElement(f.Spacer,null),$.createElement(f.ButtonInnerColumn,null,$.createElement(f.ButtonTitle,{content:(S=s.intl,S.formatMessage({id:"1xxmJZ",defaultMessage:"Copy link"}))})))),(()=>{let e=null;return o&&!g&&(e=$.createElement(a.Text,null,s.intl.formatMessage({id:"wVml0u",defaultMessage:"You don’t have permission to copy this link."}))),e?$.createElement(a.Tooltip.Control,{open:i,placement:"top",auto:!0,triggerRef:l,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1)},e):null})());var S};at.displayName="LoadedButton";const nt=()=>$.createElement(f.ButtonWrapper,{"data-uxa-log":"sm24-copy-link-button.loading","data-uxa-interactions":"shown click"},$.createElement(f.VerticalButton,{disabled:!0},$.createElement(f.ButtonIconContainer,null,$.createElement(a.UIIcon,{src:a.LinkLine,size:"medium"})),$.createElement(f.Spacer,null),$.createElement(f.ButtonInnerColumn,null,$.createElement(a.Skeleton.Text,{size:"small",style:{marginTop:22}}))));nt.displayName="LoadingButton";const ot=({store:e,isSimpleCopyLinkPending:t})=>{const{variant:n,isLoading:o}=a.useExperimentVariant("sm24_obj_metadata_new_api"),i=He();return o||"V1"===n&&"loading"===i.status?$.createElement(nt,null):"V1"===n&&"error"===i.status?null:"V1"===n&&"loaded"===i.status?$.createElement(at,{store:e,objectMetadata:i.objectMetadata,isSimpleCopyLinkPending:t}):$.createElement(at,{store:e})};ot.displayName="Inner";const it=e=>{const t=(e=>u.useInitStore(e,(e=>({$props:e,$isHovered:u.store(!1),$hoverStartTime:u.store(0),$componentViewTime:u.store(0)}))))(e);return $.createElement(ot,{store:t,isSimpleCopyLinkPending:e.isSimpleCopyLinkPending})};var rt;it.displayName="CopyLinkButton",function(e){e.MAIN="main",e.QRCODE="qrcode",e.INBAND="inband",e.MANAGE_ACCESS="manage_access",e.COPY_LINK="copy_link",e.SETTINGS="settings",e.ERROR="error"}(rt||(rt={}));const st=({store:e})=>{const{objectIdentifier:t,shouldUseSimpleCopyLink:n,isSimpleCopyLinkPending:o}=u.useStore(e.$props),i=u.useStore(e.$componentViewTime),{variant:r,isLoading:s}=a.useExperimentVariant("sm24_copy_link"),l=$.useCallback((()=>{u.batch((()=>{e.$props.get().copyLinkHandler(),e.$props.get().onActionClicked(!0)}))}),[e]),d=c.usePlatform()===c.Platforms.METASERVER,g=$.useCallback((()=>{let t=()=>{};const a=new Promise((e=>{t=e}));if("undefined"!=typeof ClipboardItem&&navigator.clipboard.write){const e=new ClipboardItem({"text/plain":a});navigator.clipboard.write([e])}else a.then((e=>navigator.clipboard.writeText(e)));const n={write:e=>t(e)};d?(e.$clipboardWriter.set(n),e.$isClickawayLocked.set(!0),E.showOQModalOrContinue({action:"share_link",continueCallback:()=>{u.batch((()=>{e.$currentScreen.set(rt.COPY_LINK),e.$isClickawayLocked.set(!1)}))},abortCallback:()=>{e.$isClickawayLocked.set(!1)}})):u.batch((()=>{e.$clipboardWriter.set(n),e.$currentScreen.set(rt.COPY_LINK)}))}),[e,d]);return $.useMemo((()=>!n&&(!s&&r&&a.logExposure({feature:"sm24_copy_link",variant:r}),!s&&"V3"===r)),[n,r,s])?$.createElement(ze,{onCopyLinkButtonClicked:g,objectIdentifier:t,componentViewTime:i}):$.createElement(it,{onClickCopyLinkButton:l,objectIdentifier:t,isSimpleCopyLinkPending:o})};st.displayName="CopyLinkButton";const lt=e=>e.formatMessage({id:"LXsTaR",defaultMessage:"Share with Stacks"}),ct=e=>e.formatMessage({id:"Sk39rj",defaultMessage:"New"}),dt=Symbol("ON_CLICK"),ut=Symbol("ON_MOUSE_ENTER"),gt=Symbol("ON_MOUSE_LEAVE"),{useEmitter:mt,defaultEmitter:pt}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),o=t(a.Context$5),i=t(a.Context$6),r=t(a.Context$7),s={...a.getTags$4(n),...a.getTags$5(o),...a.getTags$6(i),...a.getTags$7(r)},l={...a.getProperties$4(n),...a.getProperties$5(o),...a.getProperties$6(i),...a.getProperties$7(r)};if(e.key===dt)return a.UDCL.logEvent(m.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"stack",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...s,action:"stack"}}),void a.UDCL.logEvent(S.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"stack",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!0}),{tags:{...s,action:"stack"}});e.key!==ut?e.key!==gt||a.UDCL.logEvent(S.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"stack",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!1}),{tags:{...s,action:"stack"}}):a.UDCL.logEvent(S.PAP_Hover_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"stack"}),{tags:{...s,action:"stack"}})})),_t="stack-button",Et="stack-icon",ft=({store:e,showStackNewFeatureBadge:t,user:n})=>{const o=mt(),i=$.default.useCallback((()=>{const a=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0,i=Date.now()-e.$componentViewTime.get();o.select(dt).emit({dwellTime:a,timeSinceView:i}),e.$isHovered.set(!1),t&&y.setUserMetadata({FSS_STACKS_SM24_SEEN:!0},n),e.$props.get().onClickStackButton()}),[n,e,o,t]),r=$.default.useCallback((()=>{o.select(ut).emit(null),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now())}),[e,o]),l=$.default.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;o.select(gt).emit({dwellTime:t}),e.$isHovered.set(!1),e.$hoverStartTime.set(0)}),[e,o]);return $.default.useEffect((()=>{e.$componentViewTime.set(Date.now())}),[e]),$.default.createElement($.default.Fragment,null,$.default.createElement(f.ButtonWrapper,{onMouseEnter:r,onMouseLeave:l,"data-uxa-log":"sm24-stack-button.loaded","data-uxa-interactions":"shown click"},$.default.createElement(f.HorizontalButton,{"data-testid":_t,onClick:i},$.default.createElement(f.ButtonIconContainer,null,$.default.createElement(a.UIIcon,{src:C.CreateStackLine,size:"medium","data-testid":Et})),$.default.createElement(f.ButtonInnerRow,null,$.default.createElement(f.ButtonTitle,{content:lt(s.intl)}),t&&$.default.createElement(a.Box,{style:{height:"var(--dig-spacing__macro__small)"},color:"Identity On Yellow",borderRadius:"Small",backgroundColor:"Identity Yellow",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"Action",fontSize:"Action Small",fontWeight:"Strong",letterSpacing:"Action",paddingLeft:"10",paddingRight:"10","data-testid":"stack-new-feature-badge","aria-label":ct(s.intl)},ct(s.intl))))))};ft.displayName="StackButton";const St=({store:e})=>{const t=mt(),{isFolderFileCountOverLimit:n}=u.useStore(e.$props),[o,i]=$.default.useState(!1),r=$.default.useRef(null),l=$.default.useCallback((()=>{t.select(ut).emit(null),i(!0),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now())}),[e,t]),c=$.default.useCallback((()=>{const a=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;t.select(gt).emit({dwellTime:a}),i(!1),e.$isHovered.set(!1),e.$hoverStartTime.set(0)}),[e,t]);return $.default.createElement($.default.Fragment,null,$.default.createElement(f.ButtonWrapper,{ref:r,onMouseEnter:l,onMouseLeave:c,"data-uxa-log":"sm24-stack-button.disabled","data-uxa-interactions":"shown click"},$.default.createElement(f.HorizontalButton,{disabled:!0,"data-testid":_t},$.default.createElement(f.ButtonIconContainer,null,$.default.createElement(a.UIIcon,{src:C.CreateStackLine,size:"medium","data-testid":Et})),$.default.createElement(f.ButtonInnerColumn,null,$.default.createElement(f.ButtonTitle,{content:lt(s.intl)})))),n&&$.default.createElement(a.Tooltip.Control,{open:o,placement:"left",auto:!0,triggerRef:r,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1)},$.default.createElement(a.Text,null,s.intl.formatMessage({id:"uJJZGp",defaultMessage:"Can’t add more than 200 files to a Stack at a time"}))))};St.displayName="StackButtonDisabled";const yt=()=>$.default.createElement(f.ButtonWrapper,{"data-uxa-log":"sm24-stack-button.loading","data-uxa-interactions":"shown click"},$.default.createElement(f.HorizontalButton,{disabled:!0,"data-testid":_t},$.default.createElement(a.Skeleton.Avatar,{size:"medium",style:{marginRight:"var(--dig-spacing__dimension__12)"}}),$.default.createElement(a.Skeleton.Text,{size:"large",width:200})));yt.displayName="LoadingButton";const Ct=({store:e})=>{const{isFolderFileCountOverLimit:n,contents:o}=u.useStore(e.$props),i=a.mustGetActiveUserApiV2Properties(),[r,s]=t.useState(null);return t.useEffect((()=>{y.getUserMetadata(["FSS_STACKS_SM24_SEEN"],i).then((e=>{s(!e.FSS_STACKS_SM24_SEEN)}))}),[i]),null===r?$.default.createElement(yt,null):o?$.default.createElement(ft,{store:e,showStackNewFeatureBadge:r,user:i}):null===n?$.default.createElement(yt,null):$.default.createElement(St,{store:e})};Ct.displayName="Inner";const bt=e=>{const t=(e=>{const t=He(),a=u.useInitStore(t,(e=>e));return u.useInitStore(e,(e=>{const t=u.store(!1),n=u.store(0),o=u.store(0);return{$props:e,$data:a,$isHovered:t,$hoverStartTime:n,$componentViewTime:o}}))})(e);return $.default.createElement(Ct,{store:t})};bt.displayName="StacksButton";const vt=({store:e})=>{const t=$.useCallback((()=>{e.$props.get().createStackHandler(),e.$props.get().onActionClicked()}),[e]),a=u.useStore(e.$isFolderFileCountOverLimit),n=u.useStore(e.$contents);return $.createElement(bt,{onClickStackButton:t,isFolderFileCountOverLimit:a,contents:n})};vt.displayName="DashStacksButton";const ht=({store:e})=>{const{objectIdentifier:t}=u.useStore(e.$props),a=u.useStore(e.$componentViewTime),n=c.usePlatform()===c.Platforms.METASERVER,o=$.useCallback((()=>{u.batch((()=>{e.$isEnteringInband.set(!0),e.$currentScreen.set(rt.INBAND),e.$isInbandStarted.set(!0)}))}),[e]);return $.createElement(S.InbandEntryButton,{oid:t,onInbandButtonClicked:()=>{n?(e.$isInterstitialVisible.set(!0),E.showOQModalOrContinue({show:E.Show.WarningOnly,action:"share_add_people",continueCallback:()=>{o(),e.$isInterstitialVisible.set(!1)},abortCallback:()=>e.$isInterstitialVisible.set(!1)})):o()},componentViewTime:a})};ht.displayName="InbandInviteButton";const Lt=e=>e.formatMessage({id:"O6jjXZ",defaultMessage:"Create a view-only QR code"}),kt=Symbol("ON_CLICK"),At=Symbol("ON_MOUSE_ENTER"),Tt=Symbol("ON_MOUSE_LEAVE"),{useEmitter:It,defaultEmitter:$t}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),o=t(a.Context$5),i=t(a.Context$6),r=t(a.Context$7),s={...a.getTags$4(n),...a.getTags$5(o),...a.getTags$6(i),...a.getTags$7(r)},l={...a.getProperties$4(n),...a.getProperties$5(o),...a.getProperties$6(i),...a.getProperties$7(r)};if(e.key===kt)return a.UDCL.logEvent(m.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"qr_code",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...s,action:"qr_code"}}),void a.UDCL.logEvent(S.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"qr_code",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!0}),{tags:{...s,action:"qr_code"}});e.key!==At?e.key!==Tt||a.UDCL.logEvent(S.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"qr_code",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!1}),{tags:{...s,action:"qr_code"}}):a.UDCL.logEvent(S.PAP_Hover_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"qr_code"}),{tags:{...s,action:"qr_code"}})})),Mt=({store:e})=>{const[t,n]=$.useState(!1),o=$.useRef(null),i=u.useStore(e.$data),r=It(),l=$.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0,a=Date.now()-e.$componentViewTime.get();r.select(kt).emit({dwellTime:t,timeSinceView:a}),e.$isHovered.set(!1),e.$props.get().onClickQrCodeButton()}),[e,r]),c=$.useCallback((()=>{r.select(At).emit(null),n(!0),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now())}),[e,r]),d=$.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;r.select(Tt).emit({dwellTime:t}),n(!1),e.$isHovered.set(!1),e.$hoverStartTime.set(0)}),[e,r]);$.useEffect((()=>{e.$componentViewTime.set(Date.now())}),[e]);const g="loaded"===i.status?i.objectMetadata:void 0,m=!!g&&a.getCanCreateLink(g,a.VIEWER,!1),p=m?Lt(s.intl):s.intl.formatMessage({id:"8T+dAM",defaultMessage:"You don’t have permission to create a QR code."});return $.createElement($.Fragment,null,$.createElement(a.Box,{ref:o,onMouseEnter:c,onMouseLeave:d,"data-uxa-log":"sm24-qrcode-button.loaded","data-uxa-interactions":"shown click"},$.createElement(f.UtilityIconButton,{"data-testid":"qr-code-button",onClick:l,variant:e.$props.get().buttonVariant,disabled:!m},$.createElement(a.UIIcon,{src:C.QrCodeLine,"aria-label":Lt(s.intl)})),$.createElement(a.Tooltip.Control,{open:t,placement:"top",auto:!0,triggerRef:o,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)},$.createElement(a.Text,null,p))))};Mt.displayName="LoadedButton";const Nt=({store:e})=>$.createElement(Mt,{store:e});Nt.displayName="Inner";const wt=e=>{const t=(e=>{const t=He(),a=u.useInitStore(t,(e=>e));return u.useInitStore(e,(e=>{const t=u.store(!1),n=u.store(0),o=u.store(0);return{$props:e,$data:a,$isHovered:t,$hoverStartTime:n,$componentViewTime:o}}))})(e);return $.createElement(Nt,{store:t})};wt.displayName="QrCodeButton";const Rt=({store:e,buttonVariant:t,onRequestClose:a,shouldDisableQRCodeAnimation:n})=>{const o=c.usePlatform()===c.Platforms.METASERVER,i=$.useCallback((()=>{u.batch((()=>{n?e.$currentScreen.set(rt.QRCODE):(e.$isExitingMainToQr.set(!0),e.$isEnteringQr.set(!0))}))}),[e.$isExitingMainToQr,e.$isEnteringQr,e.$currentScreen,n]),r=$.useCallback((()=>{o?(e.$isInterstitialVisible.set(!0),E.showOQModalOrContinue({action:"share_qr_code",continueCallback:()=>{i(),e.$isInterstitialVisible.set(!1)},abortCallback:()=>{a(),e.$isInterstitialVisible.set(!1)}})):i()}),[o,i,a,e.$isInterstitialVisible]);return $.createElement(wt,{onClickQrCodeButton:r,buttonVariant:t})};Rt.displayName="QrCodeButton";const xt=e=>e.formatMessage({id:"8sEPDx",defaultMessage:"Settings"}),Ot=Symbol("ON_CLICK"),Pt=Symbol("ON_MOUSE_ENTER"),Dt=Symbol("ON_MOUSE_LEAVE"),{useEmitter:Ut,defaultEmitter:Bt}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),o=t(a.Context$5),i=t(a.Context$6),r=t(a.Context$7),s={...a.getTags$4(n),...a.getTags$5(o),...a.getTags$6(i),...a.getTags$7(r)},l={...a.getProperties$4(n),...a.getProperties$5(o),...a.getProperties$6(i),...a.getProperties$7(r)};if(e.key===Ot)return a.UDCL.logEvent(m.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"settings",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...s,action:"settings"}}),void a.UDCL.logEvent(S.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"settings",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!0}),{tags:{...s,action:"settings"}});e.key!==Pt?e.key!==Dt||a.UDCL.logEvent(S.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"settings",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!1}),{tags:{...s,action:"settings"}}):a.UDCL.logEvent(S.PAP_Hover_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"settings"}),{tags:{...s,action:"settings"}})})),Vt=({store:e})=>{const[t,n]=$.useState(!1),o=$.useRef(null),i=Ut(),r=$.useCallback((()=>{const t=e.$data.get(),n=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0,o=Date.now()-e.$componentViewTime.get();i.select(Ot).emit({dwellTime:n,timeSinceView:o}),e.$isHovered.set(!1);let r=!1;"loaded"!==t.status||a.isNewApiMetadata(t.objectMetadata)?"loaded"===t.status&&a.isNewApiMetadata(t.objectMetadata)&&(r=!a.getCanInvite(t.objectMetadata,m.VIEWER)&&!a.getCanInvite(t.objectMetadata,m.EDITOR)):r=a.getIsLinkOnlyMode(t.objectMetadata),e.$props.get().onClickSettingsButton({shouldOpenLinkSettings:r})}),[e,i]),l=$.useCallback((()=>{i.select(Pt).emit(null),n(!0),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now())}),[e,i]),c=$.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;i.select(Dt).emit({dwellTime:t}),n(!1),e.$isHovered.set(!1),e.$hoverStartTime.set(0)}),[e,i]);return $.useEffect((()=>{e.$componentViewTime.set(Date.now())}),[e]),$.createElement($.Fragment,null,$.createElement(f.UtilityIconButton,{"data-testid":"settings-button",onClick:r,onMouseEnter:l,onMouseLeave:c,ref:o,variant:e.$props.get().buttonVariant,"data-uxa-log":"sm24-settings-button.loaded","data-uxa-interactions":"shown click","data-campaign-element-id":"share-modal-settings-button"},$.createElement(a.UIIcon,{src:b.SettingsLine,"aria-label":xt(s.intl)})),$.createElement(a.Tooltip.Control,{open:t,placement:"top",auto:!0,triggerRef:o,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)},$.createElement(a.Text,null,xt(s.intl))))};Vt.displayName="LoadedButton";const jt=({store:e})=>$.createElement(Vt,{store:e});jt.displayName="Inner";const Ft=e=>{const t=(e=>{const t=He(),a=u.useInitStore(t,(e=>e));return u.useInitStore(e,(e=>{const t=u.store(!1),n=u.store(0),o=u.store(0);return{$props:e,$data:a,$isHovered:t,$hoverStartTime:n,$componentViewTime:o}}))})(e);return $.createElement(jt,{store:t})};Ft.displayName="SettingsButton";const Ht=({store:e,buttonVariant:t})=>{const{objectIdentifier:a}=u.useStore(e.$props),n=$.useCallback((t=>{const a=e.$props.get();"integrated_v1"!==a.settingsMode?(a.onActionClicked(),a.settingsHandler(t)):e.$currentScreen.set(rt.SETTINGS)}),[e]);return $.createElement(Ft,{onClickSettingsButton:n,objectIdentifier:a,buttonVariant:t})};Ht.displayName="SettingsButton";const qt=e=>e.formatMessage({id:"FuFURj",defaultMessage:"Transfer a copy"}),Kt=Symbol("ON_CLICK"),Gt=Symbol("ON_CLICK_ENABLE_TRANSFER"),Qt=Symbol("ON_MOUSE_ENTER"),Wt=Symbol("ON_MOUSE_LEAVE"),{useEmitter:Yt,defaultEmitter:zt}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),o=t(a.Context$5),i=t(a.Context$6),r=t(a.Context$7),s={...a.getTags$4(n),...a.getTags$5(o),...a.getTags$6(i),...a.getTags$7(r)},l={...a.getProperties$4(n),...a.getProperties$5(o),...a.getProperties$6(i),...a.getProperties$7(r)};if(e.key===Kt)return a.UDCL.logEvent(m.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"transfer",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...s,action:"transfer"}}),void a.UDCL.logEvent(S.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"transfer",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!0}),{tags:{...s,action:"transfer"}});e.key!==Qt?e.key!==Wt?e.key!==Gt||a.UDCL.logEvent(m.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"enable_transfer_tooltip"}),{tags:{...s,action:"transfer"}}):a.UDCL.logEvent(S.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"transfer",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!1}),{tags:{...s,action:"transfer"}}):a.UDCL.logEvent(S.PAP_Hover_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"transfer"}),{tags:{...s,action:"transfer"}})})),Jt=({store:e})=>{const t=Yt(),n=$.useCallback((()=>{const a=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0,n=Date.now()-e.$componentViewTime.get();t.select(Kt).emit({dwellTime:a,timeSinceView:n}),e.$isHovered.set(!1),e.$props.get().onClickTransferButton()}),[e,t]),o=$.useCallback((()=>{t.select(Qt).emit(null),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now())}),[e,t]),i=$.useCallback((()=>{const a=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;t.select(Wt).emit({dwellTime:a}),e.$isHovered.set(!1),e.$hoverStartTime.set(0)}),[e,t]);return $.useEffect((()=>{e.$componentViewTime.set(Date.now())}),[e]),$.createElement($.Fragment,null,$.createElement(f.ButtonWrapper,{onMouseEnter:o,onMouseLeave:i,"data-uxa-log":"sm24-transfer-button.loaded","data-uxa-interactions":"shown click"},$.createElement(f.VerticalButton,{"data-testid":"transfer-button",onClick:n},$.createElement(f.ButtonIconContainer,null,$.createElement(a.UIIcon,{src:v.DropboxTransferLine,size:"medium"})),$.createElement(f.Spacer,null),$.createElement(f.ButtonInnerColumn,null,$.createElement(f.ButtonTitle,{content:qt(s.intl)})))))};Jt.displayName="ChonkyBoiiLoadedButton";const Xt=({store:e})=>{const t=Yt(),n=c.useOpenUrl(),[o,i]=$.useState(!1),r=$.useRef(null),{canUserUseTransfer:l,canContentUseTransfer:d,canUserEnableTransfer:g}=u.useStore(e.$props),m=$.useCallback((()=>{t.select(Gt).emit(null),n("/team/admin/settings/sharing")}),[t,n]),p=$.useCallback((()=>{t.select(Qt).emit(null),i(!0),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now())}),[e,t]),_=$.useCallback((()=>{const a=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;t.select(Wt).emit({dwellTime:a}),i(!1),e.$isHovered.set(!1),e.$hoverStartTime.set(0)}),[e,t]);let E="";var S,y;return l?d||(E=(e=>e.formatMessage({id:"LvDT7L",defaultMessage:"This is not a file type that can be copied."}))(s.intl)):g?(S=s.intl,y=()=>{m()},E=S.formatMessage({id:"eGWSHS",defaultMessage:"Your team has transfer turned off. <button>Turn on</button>"},{button:e=>$.createElement(a.Button,{variant:"transparent",onClick:y},e)})):E=(e=>e.formatMessage({id:"l+F4Tm",defaultMessage:"Ask an admin to allow Transfer a copy."}))(s.intl),$.createElement($.Fragment,null,$.createElement(f.ButtonWrapper,{"data-uxa-log":"sm24-transfer-button.disabled","data-uxa-interactions":"shown click",ref:r,onMouseEnter:p,onMouseLeave:_},$.createElement(f.VerticalButton,{disabled:!0},$.createElement(f.ButtonIconContainer,null,$.createElement(a.UIIcon,{src:v.DropboxTransferLine,size:"medium"})),$.createElement(f.Spacer,null),$.createElement(f.ButtonInnerColumn,null,$.createElement(f.ButtonTitle,{content:qt(s.intl)})))),$.createElement(a.Tooltip.Control,{open:o,placement:"top",auto:!0,triggerRef:r,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1)},$.createElement(a.Text,null,E)))};Xt.displayName="ChonkyBoiiDisabledButton";const Zt=()=>$.createElement(f.ButtonWrapper,{"data-uxa-log":"sm24-transfer-button.loading","data-uxa-interactions":"shown click"},$.createElement(f.VerticalButton,{disabled:!0},$.createElement(f.ButtonIconContainer,null,$.createElement(a.UIIcon,{src:v.DropboxTransferLine,size:"medium"})),$.createElement(f.Spacer,null),$.createElement(f.ButtonInnerColumn,null,$.createElement(a.Skeleton.Text,{size:"small",style:{marginTop:22}}))));Zt.displayName="LoadingButton";const ea=({store:e})=>{const{canUserUseTransfer:t,canContentUseTransfer:a,isTransferEligibilityLoading:n}=u.useStore(e.$props);return n?$.createElement(Zt,null):t&&a?$.createElement(Jt,{store:e}):$.createElement(Xt,{store:e})};ea.displayName="Inner";const ta=e=>{const t=(e=>{const t=He(),a=u.useInitStore(t,(e=>e));return u.useInitStore(e,(e=>{const t=u.store(!1),n=u.store(0),o=u.store(0);return{$props:e,$data:a,$isHovered:t,$hoverStartTime:n,$componentViewTime:o}}))})(e);return $.createElement(ea,{store:t})};ta.displayName="TransferButton";const aa=({store:e})=>{const{objectIdentifier:t}=u.useStore(e.$props),a=$.useCallback((()=>{e.$props.get().transferHandler(),e.$props.get().onActionClicked()}),[e]),n=u.useStore(e.$canContentUseTransfer),o=u.useStore(e.$canUserUseTransfer),i=u.useStore(e.$canUserEnableTransfer),r=u.useStore(e.$isTransferEligibilityLoading);return $.createElement(ta,{canContentUseTransfer:n,canUserUseTransfer:o,canUserEnableTransfer:i,isTransferEligibilityLoading:r,onClickTransferButton:a,objectIdentifier:t})};aa.displayName="TransferButton";const na=(e,t)=>{switch(t[".tag"]){case"editor":return{title:e.formatMessage({id:"nop2ci",defaultMessage:"Edit link"}),subtitle:e.formatMessage({id:"Yzhe/8",defaultMessage:"People with this link can edit, comment, delete and add files"}),buttonTitle:e.formatMessage({id:"XcciHL",defaultMessage:"Edit link"})};case"viewer":return{title:e.formatMessage({id:"B6qDgp",defaultMessage:"View link"}),subtitle:e.formatMessage({id:"CWTjfa",defaultMessage:"People with this link can view, comment, and download"}),buttonTitle:e.formatMessage({id:"Ok2dm/",defaultMessage:"View link"})};default:return{title:"",subtitle:"",buttonTitle:""}}},oa=()=>$.createElement("div",{"data-testid":"loading-screen",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"var(--dig-spacing__micro__small)",height:"122px"},"data-uxa-log":"sm24-copy_link_screen.loading","data-uxa-interactions":"shown"},$.createElement(a.Spinner,{size:"medium",withTrack:!0,hasOpaqueTrack:!0}),$.createElement(a.Text,{size:"small",color:"subtle"},s.intl.formatMessage({id:"XtsMXq",defaultMessage:"Getting the link"})));oa.displayName="LoadingScreen";const ia=Symbol("COPY_LINK_SCREEN_LINK_CREATED"),ra=Symbol("COPY_LINK_HANDLE_AUDIENCE_CHANGE"),sa=Symbol("COPY_LINK_ACCESS_LEVEL_TOGGLED"),la=Symbol("COPY_LINK_HANDLE_ACCESS_LEVEL_CHANGE"),ca=Symbol("COPY_LINK_SCREEN_LOADING"),da=Symbol("COPY_LINK_SCREEN_LOADED"),ua=Symbol("COPY_LINK_SETTINGS_BUTTON_CLICKED"),ga=Symbol("COPY_LINK_AUDIENCE_TOGGLED"),ma=Symbol("COPY_LINK_SCREEN_ERROR"),pa=Symbol("COPY_LINK_SCREEN_LINK_COPIED"),_a=Symbol("COPY_LINK_CTA_CLICKED"),Ea=Symbol("COPY_LINK_UPDATING"),fa=Symbol("COPY_LINK_MANAGE_ACCESS_LEVEL_CLICKED"),Sa=Symbol("ON_CREATE_SHARED_LINK_START"),ya=Symbol("ON_CREATE_SHARED_LINK_SUCCESS"),Ca=Symbol("ON_CREATE_SHARED_LINK_ERROR"),ba=Symbol("ON_CREATE_SHARED_LINK_CANCELED"),va=Symbol("ON_RECOPY_LINK_START"),ha=Symbol("ON_COPY_SHARED_LINK_SUCCESS"),La=Symbol("ON_COPY_SHARED_LINK_ERROR"),ka=Symbol("ON_COPY_SHARED_LINK_CANCELED"),Aa=Symbol("COPY_LINK_SCREEN_ERROR_HELP_CLICKED"),{useEmitter:Ta,defaultEmitter:Ia}=a.defineLogger((async({event:e,getContextValue:t})=>{var n,o;const i=t(a.Context$4),r=t(a.Context$5),s=t(a.Context$6),l=t(a.Context$7),c={...a.getTags$4(i),...a.getTags$5(r),...a.getTags$6(s),...a.getTags$7(l)},d={isDir:c.isDir,isSm24:c.isSm24,screen:c.screen,actionSurfaceAndElement:`${c.actionSurface}___${c.actionElement}`},u={...a.getProperties$4(i),...a.getProperties$5(r),...a.getProperties$6(s),...a.getProperties$7(l)},g={isDir:u.isDir,actionSurface:null!==(n=u.actionSurface)&&void 0!==n?n:"undefined",actionElement:null!==(o=u.actionElement)&&void 0!==o?o:"undefined",contentAction:u.contentAction,shareModalType:u.shareModalType,contentIdentifier:u.contentIdentifier,screen:u.screen};if(u.isDir?(g.nsId=Number(u.contentIdentifier),u.sharedObjType&&(g.folderType=a.getFolderTypeFromSharedObjType(u.isDir,u.sharedObjType))):g.fileExtension=u.fileExtension,e.key!==ra)if(e.key!==sa)if(e.key!==la)if(e.key!==ia)if(e.key!==ca)if(e.key!==da)if(e.key!==ua)if(e.key!==ga)if(e.key!==ma)if(e.key!==pa)if(e.key!==_a)if(e.key!==Ea)if(e.key!==fa){if(e.key===Sa){const t={...g,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel};return a.UDCL.logStart(a.PAP_Create_SharedLink({...t}),{tags:{...d}}),void(e.payload.alsoLogCopyLinkEvent&&a.UDCL.logStart(a.PAP_Copy_SharedLink({...t}),{tags:{...d}}))}if(e.key===ya){const t=await a.getLinkProps(e.payload.linkMetadata.url,e.payload.resolvedAccessLevel,g.sharedLinkIdentifier),n={...g,...t,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel,sharedLinkResolvedAccessLevel:e.payload.resolvedAccessLevel,createdNewLink:e.payload.isNewlyCreated};return e.payload.httpStatusCode&&(n.httpStatusCode=e.payload.httpStatusCode),void a.UDCL.logEnd(a.PAP_Create_SharedLink({eventState:"success",...n}),{tags:{...d,createdNewLink:e.payload.isNewlyCreated.toString()},eventState:"success"})}if(e.key===Ca){const t={...g,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel,createSharedLinkErrorReason:a.getCreateSharedLinkErrorReasonFromString(e.payload.error)};return e.payload.httpStatusCode&&(t.httpStatusCode=e.payload.httpStatusCode),a.UDCL.logEnd(a.PAP_Create_SharedLink({...t,eventState:"failed"}),{tags:{...d},eventState:"failed"}),void(e.payload.alsoLogCopyLinkEvent&&a.UDCL.logEnd(a.PAP_Copy_SharedLink({...g,eventState:"failed"}),{tags:{...d},eventState:"failed"}))}if(e.key===ba)return a.UDCL.logEnd(a.PAP_Create_SharedLink({...g,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel,eventState:"canceled"}),{tags:{...d,cancelType:e.payload.cancelType},eventState:"canceled"}),void(e.payload.alsoLogCopyLinkEvent&&a.UDCL.logEnd(a.PAP_Copy_SharedLink({...g,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel,eventState:"canceled"}),{tags:{...d,cancelType:e.payload.cancelType},eventState:"canceled"}));if(e.key!==va)if(e.key!==ha)if(e.key!==La)if(e.key!==ka)e.key!==Aa||a.UDCL.logEvent("ops.sm24.copyLinkScreenErrorHelpClicked",{tags:d});else{let t={...g,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel,eventState:"canceled"};if(e.payload.linkMetadata){const n=await a.getLinkProps(e.payload.linkMetadata.url,e.payload.linkMetadata.link_permissions.link_access_level[".tag"],g.sharedLinkIdentifier);t={...t,...n}}a.UDCL.logEnd(a.PAP_Copy_SharedLink(t),{tags:{...d,cancelType:e.payload.cancelType},eventState:"canceled"})}else{let t={...g,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel,createSharedLinkErrorReason:a.getCreateSharedLinkErrorReasonFromString(e.payload.error),eventState:"failed"};if(e.payload.linkMetadata){const n=await a.getLinkProps(e.payload.linkMetadata.url,e.payload.linkMetadata.link_permissions.link_access_level[".tag"],g.sharedLinkIdentifier);t={...t,...n}}a.UDCL.logEnd(a.PAP_Copy_SharedLink(t),{tags:{...d},eventState:"failed"})}else{const t=await a.getLinkProps(e.payload.linkMetadata.url,e.payload.resolvedAccessLevel,g.sharedLinkIdentifier);a.UDCL.logEnd(a.PAP_Copy_SharedLink({...g,...t,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel,sharedLinkResolvedAccessLevel:e.payload.resolvedAccessLevel,createdNewLink:e.payload.isNewlyCreated,eventState:"success"}),{tags:{...d,createdNewLink:e.payload.isNewlyCreated.toString()},eventState:"success"})}else{const t=await a.getLinkProps(e.payload.linkMetadata.url,e.payload.resolvedAccessLevel,g.sharedLinkIdentifier);a.UDCL.logStart(a.PAP_Copy_SharedLink({...t,...g,sharedLinkRequestedAccessLevel:e.payload.requestedAccessLevel}),{tags:{...d}})}}else a.UDCL.logEvent("ops.sm24.copyLinkManageAccessLevelClicked",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkUpdating",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkCtaClicked",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkScreenLinkCopied",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkScreenError",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkAudienceToggled",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkSettingsButtonClicked",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkScreenLoaded",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkScreenLoading",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkScreenlinkCreated",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkHandleAccessLevelChange",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkAccessLevelToggled",{tags:d});else a.UDCL.logEvent("ops.sm24.copyLinkHandleAudienceChange",{tags:d})})),$a=(e,n)=>{var o,i,r;const s=Ta(),d=c.useLogger(),u=(e=>l.useMutation({mutationFn:e=>a.createSharedLinkWithSettingsMutationFn()({queryClient:l.queryClient,reqCtx:{}})({apiArg:e}),onSettled:async()=>await g.invalidateListSharedLinks(e)}))(e);if(t.useEffect((()=>{u.isIdle&&(s.select(Sa).emit({requestedAccessLevel:n[".tag"],alsoLogCopyLinkEvent:!0}),u.mutate({path:a.getContentIdOrPathFromObjectIdentifier(e),settings:{access:n}}))}),[u,n,e,s]),u.isSuccess){const e=u.data.apiData;return wa(e)?(s.select(ya).emit({requestedAccessLevel:n[".tag"],resolvedAccessLevel:e.link_permissions.link_access_level[".tag"],isNewlyCreated:!0,linkMetadata:e,httpStatusCode:200}),s.select(ia).emit(null),{isLoading:!1,isError:!1,output:e,isNewlyCreated:!0}):(s.select(Ca).emit({requestedAccessLevel:n[".tag"],error:"type_error",alsoLogCopyLinkEvent:!0}),d("SHARE_MODAL_SHARE__COPY_LINK_LEGO__CREATE_ERROR",{linkMetadata:e}),{isLoading:!1,isError:!0,error:{".tag":"type_error"}})}if(u.isError){const e=null===(o=u.error.raw)||void 0===o?void 0:o.status,t=null===(i=u.error)||void 0===i?void 0:i.error,a=(e=>{if(e&&"shared_link_already_exists"===e[".tag"]){const t=e.shared_link_already_exists;if(t&&".tag"in t&&"metadata"===t[".tag"]&&"metadata"in t)return t.metadata}})(t);return wa(a)?(s.select(ya).emit({requestedAccessLevel:n[".tag"],resolvedAccessLevel:a.link_permissions.link_access_level[".tag"],isNewlyCreated:!1,linkMetadata:a,httpStatusCode:e}),s.select(ia).emit(null),{isLoading:!1,isError:!1,output:a,isNewlyCreated:!1}):(s.select(Ca).emit({requestedAccessLevel:n[".tag"],error:null!==(r=t&&t[".tag"])&&void 0!==r?r:"unknown_error_type",alsoLogCopyLinkEvent:!0,httpStatusCode:e}),d("SHARE_MODAL_SHARE__COPY_LINK_LEGO__CREATE_ERROR",{linkMetadata:null}),{isLoading:!1,isError:!0,error:t})}return u.isLoading||u.isIdle?{isLoading:!0}:(s.select(Ca).emit({requestedAccessLevel:n[".tag"],error:"unknown_mutation_error",alsoLogCopyLinkEvent:!0}),{isLoading:!1,isError:!0,error:{".tag":"unknown_mutation_error"}})},Ma=e=>function(e){switch(e){case"viewer":return U;case"editor":return B;default:throw new Error(`Invalid tag: ${e}`)}}(e.link_permissions.link_access_level[".tag"]),Na=e=>function(e){switch(e){case"no_one":return x;case"password":return O;case"team":return P;case"public":return D;default:throw new Error(`Invalid tag: ${e}`)}}(e.link_permissions.effective_audience[".tag"]),wa=e=>{if(!e)return!1;const t=e.link_permissions.link_access_level,a=e.link_permissions.effective_audience,n=e.url;return!(null==t||null==a||null==n||"editor"!==t[".tag"]&&"viewer"!==t[".tag"]||"no_one"!==a[".tag"]&&"password"!==a[".tag"]&&"team"!==a[".tag"]&&"public"!==a[".tag"])};var Ra;!function(e){e.IDLE="IDLE",e.CREATING_LINK="CREATING_LINK",e.CREATED_LINK="CREATED_LINK",e.ERROR_CREATING_LINK="ERROR_CREATING_LINK",e.COPIED_LINK="COPIED_LINK",e.ERROR_COPYING_LINK="ERROR_COPYING_LINK",e.CAN_COPY_LINK="CAN_COPY_LINK"}(Ra||(Ra={}));const xa={$props:u.atom({oid:{".tag":"file",fileId:""},objectMetadataResult:{isLoading:!0},defaultLinkResult:{isLoading:!0},settingsHandler:()=>{},manageAccessHandler:()=>{},onRequestClose:()=>{},onBlockClickaway:()=>{},onUnblockClickaway:()=>{}}),$currentLinkMetadata:u.atom(null),$linkStatus:u.atom(Ra.IDLE),$linkError:u.atom(null),$isLinkNewlyCreated:u.atom(!1),$currentLinkAudience:u.atom(x),$currentLinkAccessLevel:u.atom(U),$requestedAccessLevel:u.atom(V),$senderTrackkey:u.atom("")},{StoreProvider:Oa,useStore:Pa}=u.defineStoreProvider((e=>{const t=u.atom(Ra.CREATING_LINK),n=u.atom(null),o=u.atom(x),i=u.atom(U),r=u.atom(V),s=u.atom(!1),l=u.atom(null),c=u.atom(a.vendSenderTrackey()),d=u.proxy((()=>e.get().defaultLinkResult));return d.obs((()=>{const e=d.get();if(e.isLoading||e.isError||!e.output)!e.isLoading&&e.isError&&(l.set(e.error),t.set(Ra.ERROR_CREATING_LINK));else{const r=e.output;i.set(Ma(r)),o.set(Na(r));const l=a.appendTrackeyToSharedLinkAndSortParams(r.url,c.get());n.set({...r,url:l}),s.set(e.isNewlyCreated),t.set(Ra.CREATED_LINK)}})),{$props:e,$currentLinkMetadata:n,$linkStatus:t,$linkError:l,$isLinkNewlyCreated:s,$currentLinkAccessLevel:i,$currentLinkAudience:o,$requestedAccessLevel:r,$senderTrackkey:c}}),xa),Da=e=>{const t=_.useSharingObjectMetadata(e.oid.fileId),n=$a(e.oid,V),o=a.useGetContextValue()(a.Context$4),i=$.useMemo((()=>o?{...o,contentAction:"copy_link"}:null),[o]);return $.createElement(a.ContextProvider,{context:a.Context$4,value:i},$.createElement(Oa,{objectMetadataResult:t,defaultLinkResult:n,...e}))};Da.displayName="Provider";const Ua=()=>{const e=Pa(),t=u.useStore(e.$props),n=$.useCallback((()=>{t.onRequestClose()}),[t]);return $.createElement("div",{className:d.classes.headerSectionButtonContainer,"data-testid":"close-button"},$.createElement(a.IconButton,{variant:"borderless",shape:"standard",size:"medium",tone:"neutral",onClick:n,"aria-label":s.intl.formatMessage({id:"GKzMoF",defaultMessage:"Close"})},$.createElement(a.UIIcon,{src:a.CloseLine})))};Ua.displayName="CloseButton";const Ba=()=>{const e=Pa(),t=u.useStore(e.$props),{objectMetadataResult:n}=t,o=!(!n.isLoading&&n.isError),i=u.useAtom(e.$linkStatus),r=n.isLoading||n.isError?"":a.getName(n.output),l=$.useMemo((()=>i===Ra.COPIED_LINK?s.intl.formatMessage({id:"K4WVkI",defaultMessage:"Link copied to"}):(e=>e.formatMessage({id:"DRh5LI",defaultMessage:"Copy link to"}))(s.intl)),[i]);return $.createElement("div",{style:{display:"flex",alignItems:"flex-start"}},o&&$.createElement("div",{className:d.classes.headerSectionTextContainer,"data-testid":"header-section",id:"copy-link-header"},$.createElement(a.Text,{size:"medium",isBold:!0,className:d.classes.headerSectionPrimaryText},$.createElement(a.Truncate,{location:.5},l)),$.createElement(a.Text,{size:"small",color:"subtle"},$.createElement(a.Truncate,{location:.5},r))),$.createElement(Ua,null))};Ba.displayName="HeaderSection";a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/legos/copy-link-screen/internals/link-section.module.out-vflJgUUnr.css",(e=>"._badgeAsText_gpgfl_1{text-wrap:nowrap;align-items:center;border-radius:var(--dig-radius__small);display:flex;font-family:var(--dig-type__family__action);font-size:var(--dig-type__size__action__small);font-weight:500;letter-spacing:var(--dig-type__letterspacing__action);margin-right:calc(var(--dig-spacing__micro__xsmall)*-1);padding-left:var(--dig-spacing__micro__small);padding-right:var(--dig-spacing__micro__small);white-space:nowrap;width:fit-content}._badgeAsTextSuccess_gpgfl_20{background-color:var(--dig-color__success__surface--state-1);color:var(--dig-color__success__base)}._badgeAsTextUpdate_gpgfl_26{background-color:var(--dig-color__selection__surface--state-1);color:var(--dig-color__selection__base)}._badgeIcon_gpgfl_32{padding-right:var(--dig-spacing__micro__xsmall)}._badgeAsButton_gpgfl_36{margin-right:calc(var(--dig-spacing__micro__xsmall)*-1)}._updatingContainer_gpgfl_40{position:relative}._updatingOverlay_gpgfl_45{opacity:0;pointer-events:none;position:absolute;right:12px;top:50%;transform:translateY(-50%);transition:opacity .2s ease;z-index:1}._updatingContainer_gpgfl_40:has(input:disabled){pointer-events:none}._updatingContainer_gpgfl_40:has(input:disabled) ._updatingOverlay_gpgfl_45{opacity:1}"));const Va="_badgeAsTextSuccess_gpgfl_20 _badgeAsText_gpgfl_1",ja="_badgeAsButton_gpgfl_36",Fa=()=>{const e=Pa(),t=u.useAtom(e.$currentLinkMetadata),n=c.useLogger(),o=Ta(),i=u.useAtom(e.$currentLinkAccessLevel),r=u.useAtom(e.$isLinkNewlyCreated),s=(()=>{var e;const{user:t}=a.useActiveUser(),n=a.useGetContextValue(),o=null===(e=n(a.Context$4))||void 0===e?void 0:e.tiburonOrigin,i=n(a.Context$6),r=$.useRef(!1);return $.useCallback((async()=>{if(t&&a.markMilestoneAsCompleted(t,c.ActivationTileMilestoneId.SHARE_CONTENT),i&&!r.current){r.current=!0;const e=a.isNewApiMetadata(i)?i.common_metadata.path_display:i.path_display,t=a.getIsFolder(i),n={file_name:a.getName(i),file_extension:a.getExtension$1(i),file_path:e};t?a.publishEvent(a.CampaignEvents.FOLDER_OUT_OF_BAND_SHARE_SUCCESS,{context:{...n,is_team_folder:a.getIsInsideTeamFolderTree(i)?"true":"false"}}):a.publishEvent(a.CampaignEvents.FILE_OUT_OF_BAND_SHARE_SUCCESS,{context:n})}a.trackUserLeapEvent(a.SharingUserLeapEvent.SM24_OOB_SHARE_COMPLETE_CLMM_CLOSED,o)}),[t,o,i])})(),l=$.useCallback((()=>{e.$linkStatus.set(Ra.COPIED_LINK),t&&(n("SHARE_MODAL_SHARE__COPY_LINK_LEGO__COPY_SUCCESS",{linkMetadata:t}),o.select(ha).emit({requestedAccessLevel:e.$requestedAccessLevel.get()[".tag"],resolvedAccessLevel:i[".tag"],isNewlyCreated:r,linkMetadata:t}),o.select(pa).emit(null))}),[e,t,n,o,i,r]),d=$.useCallback((()=>{e.$linkStatus.set(Ra.ERROR_COPYING_LINK),t&&(n("SHARE_MODAL_SHARE__COPY_LINK_LEGO__COPY_ERROR",{linkMetadata:t}),o.select(La).emit({requestedAccessLevel:e.$requestedAccessLevel.get()[".tag"],error:"failed_copy_to_clipboard",linkMetadata:t}))}),[e,t,n,o]),g=$.useCallback((e=>{(null==t?void 0:t.url)&&e&&(e.write(t.url),l())}),[null==t?void 0:t.url,l]);return{copyLinkToClipboard:$.useCallback((e=>{(null==t?void 0:t.url)&&(e?g(e):navigator.clipboard&&navigator.clipboard.writeText(t.url).then(l,d),s())}),[null==t?void 0:t.url,s,l,d,g])}},Ha=()=>{const e=Pa(),t=u.useAtom(e.$props),{copyLinkToClipboard:n}=Fa(),o=Ta(),i=u.useAtom(e.$linkStatus),r=u.useAtom(e.$currentLinkMetadata),l=u.useAtom(e.$currentLinkAccessLevel),c=$.useRef(null),d=$.useRef(!1);$.useEffect((()=>{[Ra.COPIED_LINK].includes(i)&&c.current&&(d.current=!0,c.current.focus(),setTimeout((()=>{d.current=!1}),0))}),[i,c]);const[g,m]=$.useState(!1),p=$.useCallback((()=>{e.$requestedAccessLevel.set(l),o.select(_a).emit(null),o.select(va).emit({requestedAccessLevel:l[".tag"],linkMetadata:r,resolvedAccessLevel:l[".tag"]});let t=()=>{};const a=new Promise((e=>{t=e}));if("undefined"!=typeof ClipboardItem&&navigator.clipboard.write){const e=new ClipboardItem({"text/plain":a});navigator.clipboard.write([e])}else a.then((e=>navigator.clipboard.writeText(e)));n({write:e=>t(e)})}),[n,o,l]),_=$.useMemo((()=>null==r?void 0:r.url),[r]),E=$.useRef(null);$.useEffect((()=>{i===Ra.CREATED_LINK&&_&&_!==E.current&&(E.current=_,n(t.clipboardWriter))}),[i,_,n,t.clipboardWriter]);const f=$.useCallback((()=>{g||(i===Ra.COPIED_LINK&&e.$linkStatus.set(Ra.CAN_COPY_LINK),m(!0))}),[i,e.$linkStatus,g]),S=$.useCallback((e=>{i!==Ra.CAN_COPY_LINK&&i!==Ra.COPIED_LINK||e.target.select(),d.current||f()}),[i,f]),y=$.useCallback((e=>{e.currentTarget.contains(e.relatedTarget)||e.currentTarget===e.relatedTarget||i!==Ra.COPIED_LINK||m(!1)}),[i]);return $.createElement("div",{onMouseEnter:f,onMouseLeave:()=>{m(!1)},onBlur:y,"aria-label":na(s.intl,l).title},$.createElement("div",{"data-testid":"link-section"},$.createElement(a.TextInput,{ref:c,onCopy:p,size:"large",readOnly:!0,onFocus:S,wrapperProps:{style:{fontSize:"var(--dig-type__size__text__small)"}},value:_,withRightAccessory:(e=>{const t=(()=>{switch(i){case Ra.COPIED_LINK:return $.createElement(a.Text,{className:Va},l===B?s.intl.formatMessage({id:"qaLT/q",defaultMessage:"Edit link copied"}):(e=>e.formatMessage({id:"Ged5jl",defaultMessage:"View link copied"}))(s.intl));case Ra.CAN_COPY_LINK:return e?$.createElement(a.Button,{variant:"primary",size:"small",onClick:p,className:ja},(e=>e.formatMessage({id:"1xxmJZ",defaultMessage:"Copy link"}))(s.intl)):null;default:return null}})();return $.createElement("div",{style:{minHeight:"32px",display:"flex",alignItems:"center"},"aria-live":i===Ra.CAN_COPY_LINK?"off":"assertive"},t)})(g),"aria-label":na(s.intl,l).title})))};Ha.displayName="LinkSection";const qa=()=>{const e=s.useIntl(),t=Pa(),n=((e,t,n)=>{switch(t[".tag"]){case a.NO_ONE[".tag"]:return e.formatMessage({id:"Ca/e0Y",defaultMessage:"Only people invited can {canEdit, select, true {edit} other {view}}"},{canEdit:n===B});case a.PUBLIC[".tag"]:return e.formatMessage({id:"/wh8mz",defaultMessage:"Anyone with this link can {canEdit, select, true {edit} other {view}}"},{canEdit:n===B});case a.TEAM[".tag"]:return e.formatMessage({id:"60+xKH",defaultMessage:"Team members with this link can {canEdit, select, true {edit} other {view}}"},{canEdit:n===B});default:return""}})(e,u.useAtom(t.$currentLinkAudience),u.useAtom(t.$currentLinkAccessLevel));return $.createElement("div",{"data-testid":"link-permissions-text"},$.createElement(a.Text,{size:"small",style:{color:"var(--dig-color__text__base)"}},n))};qa.displayName="LinkPermissionsText";const Ka=()=>{const e=Pa(),t=s.useIntl(),n=u.useAtom(e.$currentLinkAccessLevel),o=Ta();return $.createElement(a.Button,{"data-testid":"settings-button",variant:"transparent",size:"small",tone:"neutral",onClick:()=>{let t;t="editor"===n[".tag"]?"edit_link_settings":"view_link_settings",o.select(ua).emit(null);e.$props.get().settingsHandler({shouldOpenLinkSettings:!0,initialTab:t})},"data-uxa-log":"copy-link-screen-settings-button.loaded","data-uxa-interactions":"shown click"},(e=>e.formatMessage({id:"6BOuuN",defaultMessage:"Manage"}))(t))};Ka.displayName="SettingsButton";const Ga=()=>{var e;const t=Pa(),a=u.useAtom(t.$props),{objectMetadataResult:n}=a,o=n.isLoading||n.isError?void 0:n.output,i=null===(e=null==o?void 0:o.common_metadata)||void 0===e?void 0:e.path_display;return $.createElement(r.CampaignContextualNudgeSection,{fqPath:i,onClose:a.onRequestClose})};Ga.displayName="CampaignContextualNudgeSection";const Qa=()=>{const e=Ta();return $.createElement("div",{style:{display:"flex",padding:"var(--dig-spacing__micro__medium)",flexDirection:"column",alignItems:"center",gap:"var(--dig-spacing__micro__small)"},"data-testid":"error-screen","data-uxa-log":"sm24-copy_link_screen.error","data-uxa-interactions":"shown"},$.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"var(--dig-spacing__micro__xsmall)"}},$.createElement(a.UIIcon,{src:a.FailLine,size:"large"})),$.createElement(a.Text,{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"var(--dig-spacing__micro__xsmall)",alignSelf:"stretch",fontStyle:"normal",fontWeight:"var(--dig-type__weight__strong)",lineHeight:"var(--dig-line-height__label__small)",letterSpacing:"var(--dig-letter-spacing__action__medium)"}},s.intl.formatMessage({id:"qmGnVg",defaultMessage:"Couldn’t copy link"})),$.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"}},$.createElement(a.Text,{style:{display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",color:"var(--dig-color__text__subtle)",textOverflow:"ellipsis",fontFamily:"var(--dig-font-family__text)",fontSize:"var(--dig-font-size__text__small)",fontStyle:"normal",fontWeight:"var(--dig-type__weight__base)",lineHeight:"var(--dig-line-height__label__small)",gap:"var(--dig-spacing__micro__xsmall)"}},(e=>e.formatMessage({id:"hkT9RW",defaultMessage:"Try reloading the page or asking us for"}))(s.intl),$.createElement(a.Link,{href:"https://help.dropbox.com",target:"_blank",rel:"noopener noreferrer",onClick:()=>{e.select(Aa).emit(null)},style:{display:"flex",justifyContent:"center",alignItems:"center",fontFamily:"var(--dig-font-family__text)",fontSize:"var(--dig-font-size__text__small)",fontStyle:"normal",fontWeight:"var(--dig-type__weight__base)",lineHeight:"var(--dig-line-height__label__small)",textDecorationLine:"underline",textDecorationStyle:"solid",color:"var(--dig-color__primary__base)"},display:"inline"},(e=>e.formatMessage({id:"yvCTUR",defaultMessage:"help"}))(s.intl)))))};Qa.displayName="ErrorScreen";const Wa=e=>$.createElement(Da,{...e},$.createElement(Ya,null));Wa.displayName="CopyLinkScreen";const Ya=()=>{const e=Pa(),t=u.useAtom(e.$props),{objectMetadataResult:n}=t,o=n.isLoading,i=!n.isLoading&&!n.isError,r=!n.isLoading&&n.isError,s=u.useAtom(e.$linkStatus),l=Ta(),c=r||s===Ra.ERROR_CREATING_LINK,d=o||s===Ra.CREATING_LINK,g=i&&s!==Ra.CREATING_LINK&&s!==Ra.ERROR_CREATING_LINK,m=$.useRef(s);$.useEffect((()=>{m.current=s}),[s]),$.useEffect((()=>()=>{m.current===Ra.CREATING_LINK&&(l.select(ba).emit({requestedAccessLevel:"default",cancelType:"unmount",alsoLogCopyLinkEvent:!0}),l.select(ka).emit({requestedAccessLevel:"default",cancelType:"unmount"}))}),[]);const p=$.useRef(void 0);return $.useLayoutEffect((()=>{const e=p.current;d&&!e?t.onBlockClickaway():!d&&e&&t.onUnblockClickaway(),p.current=d}),[d,t]),$.useEffect((()=>{g&&l.select(da).emit(null),c&&l.select(ma).emit(null),d&&l.select(ca).emit(null)}),[g,c,d,l]),d?$.createElement(oa,null):c?$.createElement(Qa,null):g?$.createElement("div",{"data-testid":"copy-link-screen-with-store","data-uxa-log":"sm24-copy_link_screen.loaded","data-uxa-interactions":"shown",style:{display:"flex",flexDirection:"column",gap:"var(--dig-spacing__micro__small)"},"aria-labelledby":"copy-link-header","aria-live":"polite"},$.createElement(Ba,null),$.createElement(Ha,null),$.createElement(a.Split,{gap:"Micro Medium",wrap:"nowrap",alignY:"center",display:"flex",width:"100%",style:{maxWidth:"100%"}},$.createElement(a.Split.Item,{width:"fill"},$.createElement(qa,null)),$.createElement(a.Split.Item,null,$.createElement(Ka,null))),$.createElement(Ga,null)):null};Ya.displayName="CopyLinkScreenWithStore";const za=({store:e})=>{const t=u.useStore(e.$props),a=u.useStore(e.$clipboardWriter),{objectIdentifier:n,manageAccessHandler:o,onRequestClose:i}=t,r=$.useCallback((t=>{const a=e.$props.get();"integrated_v1"!==a.settingsMode?a.settingsHandler(t):u.batch((()=>{t.shouldOpenLinkSettings?e.$initialSettingsTab.set("edit_link_settings"===t.initialTab?"edit_link_settings":"view_link_settings"):e.$initialSettingsTab.set("object_settings"),e.$currentScreen.set(rt.SETTINGS)}))}),[e]),s=$.useCallback((()=>{e.$isClickawayLocked.set(!0)}),[e]),l=$.useCallback((()=>{e.$isClickawayLocked.set(!1)}),[e]);return $.createElement(Wa,{oid:n,settingsHandler:r,manageAccessHandler:o,onRequestClose:i,clipboardWriter:a,onBlockClickaway:s,onUnblockClickaway:l})};za.displayName="CopyLinkScreen";const Ja=e=>e.formatMessage({id:"4mDOPx",defaultMessage:"Folder"}),Xa=(e,t)=>e.formatMessage({id:"Y8cvK0",defaultMessage:"Share {contentName}"},{contentName:_.Emstring.em_snippet(t,a.SNIPPET_SIZES.FILENAME)}),Za=e=>e.formatMessage({id:"EbXgYu",defaultMessage:"Create QR code"}),en=e=>e.formatMessage({id:"Qn7mSN",defaultMessage:"People with access to"}),tn=e=>e.formatMessage({id:"FQ6/b6",defaultMessage:"Link copied to"}),an=(e,t)=>e.formatMessage({id:"a0hOt7",defaultMessage:"Settings for {contentName}"},{contentName:_.Emstring.em_snippet(t,a.SNIPPET_SIZES.FILENAME)});const nn=Symbol("ON_CLICK_OUTSIDE"),on=Symbol("ON_RESIZE"),rn=Symbol("ON_OPEN"),sn=Symbol("ON_OVER_QUOTA_SHARE_BANNER_UPGRADE"),ln=Symbol("ON_VIEW_MANAGE_ACCESS_ENTRY_POINT_BUTTON"),cn=Symbol("ON_VIEW_ERROR_SCREEN"),{useEmitter:dn,defaultEmitter:un}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),o=t(a.Context$5),i=t(a.Context$6),r=t(a.Context$7),s={...a.getTags$4(n),...a.getTags$5(o),...a.getTags$6(i),...a.getTags$7(r)},l={...a.getProperties$4(n),...a.getProperties$5(o),...a.getProperties$6(i),...a.getProperties$7(r)};e.key!==rn?e.key!==nn&&e.key!==on?e.key!==ln?e.key!==cn?e.key===sn&&a.UDCL.logEvent(m.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:e.payload.action,flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView||void 0}),{tags:{...s,action:e.payload.action}}):a.UDCL.logEvent("ops.sm24.view_error_screen",{tags:{...s,error_type:e.payload.dataLoadErrorType||"unknown"}}):a.UDCL.logEvent(g.PAP_View_ManageAccess({...l,manageAccessElement:"manage_access_entry_point_button"}),{tags:{...s,element:"manage_access_entry_point_button"}}):a.UDCL.logEvent(m.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:e.payload.action,flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView||void 0}),{tags:{...s,action:e.payload.action}}):a.UDCL.logEvent(function(e){return{class:"sharing_sender",action:"view",object:"flexible_sharing_entrypoint",properties:e}}({...l}),{tags:s})})),gn=()=>{const e=dn(),t=He(),n="error"===t.status?t.loadError.type:void 0;return $.useEffect((()=>{n&&e.select(cn).emit({dataLoadErrorType:n})}),[n]),$.createElement(a.Box,{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"8px",height:"310px"}},$.createElement(a.Box,{style:{color:"var(--dig-color__alert__base)"}},$.createElement(a.UIIcon,{src:a.FailPictogram,size:"large"})),$.createElement(a.Box,null,$.createElement(a.Title,{size:"medium"},s.intl.formatMessage({id:"4EN/b3",defaultMessage:"Unable to share"}))),$.createElement(a.Box,null,$.createElement(a.Text,{size:"medium"},(e=>e.formatMessage({id:"dCo6oL",defaultMessage:"An unexpected error has occured."}))(s.intl))))};gn.displayName="ErrorScreen";const mn=e=>e.formatMessage({id:"yBYjtJ",defaultMessage:"Close"}),pn=Symbol("ON_CLICK"),_n=Symbol("ON_MOUSE_ENTER"),En=Symbol("ON_MOUSE_LEAVE"),{useEmitter:fn,defaultEmitter:Sn}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),o=t(a.Context$5),i=t(a.Context$6),r=t(a.Context$7),s={...a.getTags$4(n),...a.getTags$5(o),...a.getTags$6(i),...a.getTags$7(r)},l={...a.getProperties$4(n),...a.getProperties$5(o),...a.getProperties$6(i),...a.getProperties$7(r)};if(e.key===pn)return a.UDCL.logEvent(m.PAP_Select_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"close",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...s,action:"close"}}),void a.UDCL.logEvent(S.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"close",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!0}),{tags:{...s,action:"close"}});e.key!==_n?e.key!==En||a.UDCL.logEvent(S.PAP_Log_FlexibleSharingEntrypointActionDwellTime({...l,flexibleSharingEntryPointAction:"close",flexibleSharingEntryPointDwellTime:e.payload.dwellTime,flexibleSharingEntryPointDwellActionSelected:!1}),{tags:{...s,action:"close"}}):a.UDCL.logEvent(S.PAP_Hover_FlexibleSharingEntrypointAction({...l,flexibleSharingEntryPointAction:"close"}),{tags:{...s,action:"close"}})})),yn=({store:e})=>{const[t,n]=$.useState(!1),o=$.useRef(null),i=fn(),r=$.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0,a=Date.now()-e.$componentViewTime.get();i.select(pn).emit({dwellTime:t,timeSinceView:a}),e.$isHovered.set(!1),e.$props.get().onClickCloseButton()}),[e,i]),l=$.useCallback((()=>{i.select(_n).emit(null),n(!0),e.$isHovered.set(!0),e.$hoverStartTime.set(Date.now())}),[e,i]),c=$.useCallback((()=>{const t=e.$isHovered.get()?Date.now()-e.$hoverStartTime.get():void 0;i.select(En).emit({dwellTime:t}),n(!1),e.$isHovered.set(!1),e.$hoverStartTime.set(0)}),[e,i]);$.useEffect((()=>{e.$componentViewTime.set(Date.now())}),[e]);const d=u.useStore(e.$disabled);return $.createElement($.Fragment,null,$.createElement(f.HeaderIconButton,{"data-testid":"close-button",onClick:r,onMouseEnter:l,onMouseLeave:c,ref:o,variant:e.$props.get().buttonVariant,disabled:d,"data-uxa-log":"sm24-close-button","data-uxa-interactions":"click"},$.createElement(a.UIIcon,{src:a.CloseLine,"aria-label":mn(s.intl)})),$.createElement(a.Tooltip.Control,{open:!d&&t,placement:"top",auto:!0,triggerRef:o,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)},$.createElement(a.Text,null,mn(s.intl))))};yn.displayName="LoadedButton";const Cn=({store:e})=>$.createElement(yn,{store:e});Cn.displayName="Inner";const bn=e=>{const t=(e=>{const t=He(),a=u.useInitStore(t,(e=>e));return u.useInitStore(e,(e=>{const t=u.store(!1),n=u.store(0),o=u.store(0),i=u.proxy((()=>{var t;return null!==(t=e.get().disabled)&&void 0!==t&&t}));return{$props:e,$data:a,$isHovered:t,$hoverStartTime:n,$componentViewTime:o,$disabled:i}}))})(e);return $.createElement(Cn,{store:t})};bn.displayName="CloseButton";const vn=({store:e,buttonVariant:t})=>{const a=u.useStore(e.$isClickawayLocked),n=$.useCallback((()=>{e.$props.get().onRequestClose()}),[e]);return $.createElement(bn,{onClickCloseButton:n,buttonVariant:t,disabled:a})};vn.displayName="CloseButton";const hn=({store:e})=>{const{objectIdentifier:t}=u.useStore(e.$props),a=He(),n=dn(),o="loaded"===a.status?a.objectIdentifier:t,i=$.useCallback((()=>{u.batch((()=>{e.$currentScreen.set(rt.MANAGE_ACCESS),e.$isSuggestionsOpen.set(!1)}))}),[e]),r=$.useCallback((()=>{n.select(ln).emit(null)}),[n]);return o?$.createElement("div",null,$.createElement(g.ContentMemberFacepileButton,{oid:o,onClick:i,onView:r})):null};hn.displayName="ManageAccessFacepileButton";const Ln=({store:e})=>{const t=u.useStore(e.$currentScreen),{objectIdentifier:n,fileName:o,fileSize:i,shouldHideCloseButton:r,shouldShowBackButtonOnInbandShare:l,shouldShowBackButtonOnQrCodeScreen:c}=u.useStore(e.$props),g="file"!==n[".tag"],m=t===rt.INBAND,p=t===rt.MANAGE_ACCESS||t===rt.INBAND&&l||t===rt.QRCODE&&c,_=t===rt.COPY_LINK,{firstLine:E,secondLine:f}=$.useMemo((()=>{switch(t){case rt.INBAND:return{firstLine:(e=s.intl,e.formatMessage({id:"DOMI0b",defaultMessage:"Add people to"})),secondLine:o};case rt.QRCODE:return{firstLine:Za(s.intl),secondLine:o};case rt.MANAGE_ACCESS:return{firstLine:en(s.intl),secondLine:o};case rt.COPY_LINK:return{firstLine:tn(s.intl),secondLine:o};case rt.SETTINGS:return{firstLine:an(s.intl,o)};case rt.MAIN:default:return{firstLine:Xa(s.intl,o),secondLine:g?Ja(s.intl):a.formatBytes(s.intl,i,2,!1)}}var e}),[t,o,i,g]),S=$.useCallback((()=>{t===rt.MANAGE_ACCESS?e.$currentScreen.set(rt.INBAND):e.$currentScreen.set(rt.MAIN)}),[t,e.$currentScreen]),y=m?220:void 0;return _?null:$.createElement($.Fragment,null,p&&$.createElement("div",{className:d.classes.headerSectionBackButton},$.createElement(a.IconButton,{onClick:S,variant:"borderless",shape:"standard",size:"medium",tone:"neutral","data-uxa-log":`sm24_back_button_${t}`,"data-testid":"sm24-back-button"},$.createElement(a.UIIcon,{src:a.ArrowLeftLine}))),$.createElement("div",{className:d.classes.headerSectionTextContainer},$.createElement(a.Text,{size:"medium",isBold:!0,className:d.classes.headerSectionPrimaryText},$.createElement(a.Truncate,{location:.5},E)),$.createElement(a.Text,{size:"small",color:"subtle"},$.createElement(a.Truncate,{maxWidth:y,location:.5},f))),$.createElement("div",{className:d.classes.headerSectionRightContainer},m&&$.createElement(hn,{store:e}),!r&&$.createElement("div",{className:d.classes.headerSectionButtonContainer},$.createElement(vn,{store:e,buttonVariant:"borderless"}))))};Ln.displayName="HeaderSection";const kn=({store:e})=>{const t=u.useStore(e.$props),n=He(),{objectIdentifier:o,onConfirmationModalShownChange:i,onObjectIdentifierChanged:r}=t,s=u.useStore(e.$inviteTargets),l=u.useStore(e.$inviteMessage),c=$.useCallback((t=>{e.$inviteMessage.set(t)}),[e]),d=$.useCallback((t=>{e.$inviteTargets.set(t)}),[e]),g=$.useCallback((async e=>{"loaded"===n.status&&(await r(e),n.onObjectIdentifierChanged(e))}),[n,r]),p=$.useCallback((()=>{e.$isClickawayLocked.set(!0)}),[e]),E=$.useCallback((()=>{e.$isClickawayLocked.set(!1)}),[e]),f=$.useCallback((()=>{e.$isClickawayLocked.set(!1),e.$props.get().onInbandShareCompleted(),e.$props.get().shouldResetToMainAfterInbandShare&&u.batch((()=>{e.$currentScreen.set(rt.MAIN),e.$inviteTargets.set([]),e.$inviteMessage.set("")})),a.invalidateObjectMembers(o),_.invalidateSharingObjectMetadata(o),_.invalidateNewApiObjectMetadata(o)}),[e,o]),S=$.useCallback((()=>{e.$isInbandStarted.set(!0)}),[e]),y=$.useCallback((t=>{e.$isSuggestionsOpen.set(t)}),[e]),C=$.useCallback((async()=>{"loaded"===n.status&&await n.refreshObjectMetadata()}),[n]),b=$.useCallback((async()=>{"loaded"===n.status&&await n.refreshModal()}),[n]),v=u.useStore(e.$isConfidentialFolderBannerClosed),h=$.useCallback((()=>{e.$isConfidentialFolderBannerClosed.set(!0)}),[e.$isConfidentialFolderBannerClosed]);return $.createElement(m.Inband,{oid:t.objectIdentifier,inviteMessage:l,inviteTargets:s,hasUpdatedAccountMetadata:!1,onCloseClick:()=>t.onRequestClose(),onTargetsDropdownFocusChange:y,onInviteMessageChange:c,onInviteTargetsChange:d,onShareStart:p,onShareFailure:E,onInbandShareSuccess:f,onStartInband:S,onRefreshObjectMetadata:C,onRefreshModal:b,shouldDisablePostInbandShareHooks:t.shouldDisablePostInbandShareHooks,onConfirmationModalShownChange:i,isConfidentialFolderBannerClosed:v,onConfidentialFolderBannerClose:h,onObjectIdentifierChanged:g})};kn.displayName="InbandShareScreen";const An=({children:e})=>{const t=He();return $.createElement(a.ContextProvider,{context:a.Context$6,value:"loaded"===t.status?t.objectMetadata:null},$.createElement(c.MetadataProvider,{sharingObjectMetadata:"loaded"===t.status?t.objectMetadata:void 0,sharingPrefs:"loaded"===t.status?t.sharingPrefs:void 0,sharingObjectIdentifier:"loaded"===t.status?t.objectIdentifier:void 0,shareMe24Metadata:{isShareMe24:!0}},e))};An.displayName="LoggingMetadataProvider";const Tn=({store:e})=>{const{objectIdentifier:t,onRequestClose:n,onConfirmationModalShownChange:o,onObjectIdentifierChanged:i}=u.useStore(e.$props),r=He(),s=$.useCallback((async e=>{"loaded"===r.status&&(await i(e),r.onObjectIdentifierChanged(e))}),[r,i]),l=$.useCallback((t=>{const a=e.$props.get();"integrated_v1"!==a.settingsMode?a.settingsHandler(t):u.batch((()=>{t.shouldOpenLinkSettings?e.$initialSettingsTab.set("edit_link_settings"===t.initialTab?"edit_link_settings":"view_link_settings"):e.$initialSettingsTab.set("object_settings"),e.$currentScreen.set(rt.SETTINGS)}))}),[e]),c=$.useCallback((()=>{n()}),[n]),d=$.useCallback((()=>{e.$currentScreen.set(rt.INBAND)}),[e]),m=$.useCallback((()=>{e.$currentScreen.set(rt.INBAND),_.invalidateSharingObjectMetadata(t),_.invalidateNewApiObjectMetadata(t),g.invalidateListSharedLinks(t),a.invalidateObjectMembers(t),_.invalidateNewApiObjectMetadata(t)}),[t,e.$currentScreen]),p="loaded"===r.status?r.objectIdentifier:t;return p?$.createElement(a.Box,{style:{height:"322px",overflowY:"auto",scrollbarWidth:"thin"}},$.createElement(g.ContentMemberList,{objectIdentifier:p,openLinkSettings:l,onRequestClose:c,onChangeConfidentiality:d,onTransferFolderOwnership:m,onObjectIdentifierChanged:s,onConfirmationModalShownChange:o||(()=>{})})):null};Tn.displayName="ManageAccessScreen";const In=({store:e})=>{const t=u.useStore(e.$initialSettingsTab),a=u.useStore(e.$props),{objectIdentifier:n,onObjectIdentifierChanged:o,onConfirmationModalShownChange:i,manageAccessHandler:r,onRequestClose:s,shouldResetToMainOnSettingsCancel:l,shouldResetToMainOnSettingsSave:c,settingsHandler:d,shouldResetToMainOnUnshareComplete:g}=u.useStore(e.$props),m=He(),p=$.useCallback((async e=>{window.console.log("onObjectIdentifierChanged",e),"loaded"===m.status&&(await o(e),m.onObjectIdentifierChanged(e))}),[m,o]),_=$.useCallback((e=>{i&&i(e)}),[i]),E=$.useCallback((async()=>{"loaded"===m.status&&await m.refreshModal()}),[m]),f=$.useCallback((()=>{g&&e.$currentScreen.set(rt.MAIN)}),[g,e.$currentScreen]),y=$.useCallback((()=>{r()}),[r]),C=$.useCallback((()=>{s()}),[s]),b=$.useCallback((()=>{l?e.$currentScreen.set(rt.MAIN):s()}),[s,l,e.$currentScreen]),v=$.useCallback((()=>{c?e.$currentScreen.set(rt.MAIN):s()}),[s,c,e.$currentScreen]),h=$.useCallback((()=>{if(!d)return;let e;switch(t){case"view_link_settings":e="view_link_settings";break;case"edit_link_settings":e="edit_link_settings";break;default:e=void 0}C(),d({initialTab:e})}),[t,C,d]),L="loaded"===m.status?m.objectIdentifier:n;return $.createElement(S.SettingsPage,{objectIdentifier:L,initialTab:t,onClose:C,onCancel:b,onComplete:v,onManageLinkAccess:y,onConfirmationModalShownChange:_,onObjectIdentifierChanged:p,onRefreshModal:E,onFallback:a.settingsHandler?h:void 0,onUnshareCompleted:f})};In.displayName="SettingsScreen";const $n=({store:e})=>{var t;const o=u.useStore(e.$props),i=u.useStore(e.$currentScreen),r=u.useStore(e.$isExitingMainToQr),s=u.useStore(e.$isEnteringQr),l=u.useStore(e.$isEnteringInband),g=u.useStore(e.$isInbandStarted),m=u.useStore(e.$componentViewTime),p=u.useStore(e.$displayMode),_=u.useStore(e.$isInterstitialVisible),E=null!==(t=u.useStore(e.$modalCallbackRef))&&void 0!==t?t:void 0,f=c.usePlatform()===c.Platforms.METASERVER,{shouldUseDataLoadErrorScreen:S,shouldLoadErrorScreenOnInitialLoad:y,onRequestClose:C,isOpen:b}=o,v=dn(),h=He(),L="error"===h.status;$.useEffect((()=>{b&&(v.select(rn).emit(null),e.$componentViewTime.set(Date.now()),a.publishEvent(a.CampaignEvents.SHARE_MODAL_OPENED))}),[b,v,e.$componentViewTime]),$.useEffect((()=>{(L||y)&&S&&e.$currentScreen.set(rt.ERROR)}),[L,y,S,e.$currentScreen]);const k="loaded"===h.status&&h.accountMetadata.is_sharing_banned;$.useEffect((()=>{if(k){C();const t=o.referrerLoggingMetadata;e={actionSurface:null==t?void 0:t.actionSurface,actionElement:null==t?void 0:t.actionElement},a.UDCL.logEvent({class:"share",action:"shown",object:"sharing_banned_modal",properties:{actionSurface:e.actionSurface,actionElement:e.actionElement}}),a.mountModal($.default.createElement(_e,{onAfterClose:()=>{a.UDCL.logEvent({class:"share",action:"dismiss",object:"sharing_banned_modal",properties:{actionSurface:e.actionSurface,actionElement:e.actionElement}}),a.unmountModal(void 0,pe)}}),void 0,pe)}var e}),[k]);const A=$.useCallback((()=>{const t=e.$isClickawayLocked.get(),a=e.$isSuggestionsOpen.get();if(t||a)return;const n=Date.now()-m,o=g?"clickaway_from_inband":"clickaway";v.select(nn).emit({timeSinceView:n,action:o}),C()}),[e,m,g,v,C]),T=$.useCallback((()=>{const t=e.$props.get();"integrated_v1"!==t.settingsMode?(t.settingsHandler({shouldOpenLinkSettings:!0}),t.onActionClicked()):u.batch((()=>{e.$initialSettingsTab.set("view_link_settings"),e.$currentScreen.set(rt.SETTINGS)}))}),[e]),I=$.useCallback((()=>{r&&s&&(e.$isExitingMainToQr.set(!1),e.$currentScreen.set(rt.QRCODE))}),[s,r,e.$currentScreen,e.$isExitingMainToQr]),M=$.useCallback((t=>{s&&t.animationName===d.classes.fadeIn&&e.$isEnteringQr.set(!1)}),[e.$isEnteringQr,s]),N=$.useCallback((t=>{l&&t.animationName===d.classes.expandOuterWrapperInband&&e.$isEnteringInband.set(!1)}),[l,e.$isEnteringInband]),w=$.useCallback((()=>e.$displayMode.set({displayMode:"centered_v1"})),[e.$displayMode]),R=$.useMemo((()=>n.is_mobile_or_tablet()?{displayMode:"drawer",hasScrollLock:!_}:"anchored_v1"===p.displayMode?{displayMode:"anchored_v1",anchorRef:p.displayModeRef,offsetDistance:5,placement:p.displayModePositioning,onAnchorInvalid:w}:{displayMode:"centered_v1"}),[p,w,_]),x=o.canUserCreateStack,O=!o.isEncrypted,P=a.isBrowserSupportedByDash()&&!!x&&O,D=i!==rt.COPY_LINK&&i!==rt.ERROR?$.createElement(Ln,{store:e}):null;return $.createElement(ue,{onEscape:A,onClickOutside:A,isOpen:b,currentScreen:i,isExitingMainToQr:r,onOverlayOrModalAnimationEnd:I,header:D,...R,modalCallbackRef:E},$.createElement("div",{className:a.cx("oa-pulsar-effect-SHARE_MODAL_TOKENIZER")},i===rt.INBAND&&$.createElement("div",{onAnimationEnd:N,className:a.cx({[d.classes.inbandScreenExpand]:l}),style:{padding:"6px",minHeight:"310px"}},$.createElement(kn,{store:e})),i===rt.MAIN&&$.createElement($.Fragment,null,$.createElement(ge,null,f&&$.createElement(F,{onUpgrade:()=>{const e=Date.now()-m;v.select(sn).emit({timeSinceView:e,action:"over_quota_share_banner_upgrade"}),C()}})),$.createElement(ge,null,$.createElement(ht,{store:e})),$.createElement(ge,null,$.createElement(me,null,$.createElement(st,{store:e})),$.createElement(me,null,$.createElement(aa,{store:e}))),P&&$.createElement(ge,null,$.createElement(vt,{store:e})),$.createElement(ge,{styleName:a.cx(d.classes.utilityButtonRow,d.classes.buttonRowBmusQr)},$.createElement(Rt,{store:e,buttonVariant:"filled",onRequestClose:()=>{C()},shouldDisableQRCodeAnimation:o.shouldDisableQRCodeAnimation}),$.createElement(Ht,{store:e,buttonVariant:"filled"}))),i===rt.QRCODE&&$.createElement("div",{className:a.cx({[d.classes.qrScreenExpand]:!r&&s}),onAnimationEnd:M},$.createElement(ce,{objectIdentifier:o.objectIdentifier,onSettingsClick:T,onGetQrCodeError:()=>{C()},fileName:o.fileName,filePath:o.filePath})),i===rt.MANAGE_ACCESS&&$.createElement(Tn,{store:e}),i===rt.COPY_LINK&&$.createElement(za,{store:e}),i===rt.SETTINGS&&$.createElement(In,{store:e}),i===rt.ERROR&&$.createElement(gn,null)))};$n.displayName="Inner";e.Main=e=>{const t=(e=>u.useInitStore(e,(t=>{const a=u.proxy((()=>t.get().objectIdentifier)),n=u.proxy((()=>t.get().progressiveInbandVariant)),o=u.proxy((()=>t.get().canUserUseTransfer)),i=u.proxy((()=>t.get().canContentUseTransfer)),r=u.proxy((()=>t.get().canUserEnableTransfer)),s=u.proxy((()=>t.get().isTransferEligibilityLoading)),l=u.proxy((()=>t.get().isFolderFileCountOverLimit)),c=u.proxy((()=>t.get().contents)),d=u.store(0),g=u.store(!1),m=u.store(!1),p=u.store(rt.MAIN),_=u.store(!1),E=u.store(!1),f=u.store(!1),S=u.store(!1),y=u.store("anchored_v1"===e.initialDisplayMode?{displayMode:e.initialDisplayMode,displayModePositioning:e.displayModePositioning,displayModeRef:e.displayModeRef}:{displayMode:e.initialDisplayMode}),C=u.store([]),b=u.store(""),v=u.store(void 0),h=u.store(!1),L=u.store("object_settings"),k=u.proxy((()=>t.get().modalCallbackRef)),A=u.store(!1);return{$props:t,$objectIdentifier:a,$progressiveInbandVariant:n,$canUserUseTransfer:o,$canContentUseTransfer:i,$canUserEnableTransfer:r,$isTransferEligibilityLoading:s,$componentViewTime:d,$isClickawayLocked:g,$isInbandStarted:m,$currentScreen:p,$isExitingMainToQr:_,$isEnteringInband:f,$isEnteringQr:E,$isSuggestionsOpen:S,$displayMode:y,$inviteTargets:C,$inviteMessage:b,$clipboardWriter:v,$isFolderFileCountOverLimit:l,$contents:c,$isInterstitialVisible:h,$initialSettingsTab:L,$modalCallbackRef:k,$isConfidentialFolderBannerClosed:A}})))(e),{isOpen:n,onRequestClose:o}=e,i=c.usePlatform()===c.Platforms.METASERVER;return n?i?$.createElement(r.ShareBlockingWrapper,{action:a.LockedStateModalAction.SHARE_MODAL,onStatusChange:e=>{e===a.Status.USER_ABORTED_ACTION&&o()}},$.createElement(An,null,$.createElement($n,{store:t}))):$.createElement(An,null,$.createElement($n,{store:t})):null},e.Provider=Fe,e.useData=He}));
//# sourceMappingURL=c_shareme24_main.js-vflaagjnv.map

//# debugId=b6064a09-eda3-34ef-968b-8e1e2fc898ab