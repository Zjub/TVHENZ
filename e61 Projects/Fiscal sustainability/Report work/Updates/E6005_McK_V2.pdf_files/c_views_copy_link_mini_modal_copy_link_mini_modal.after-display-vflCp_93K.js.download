!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="4886c64d-2ff6-34e1-9df1-f4ccaeee747d")}catch(e){}}();
define(["exports","react","./c_chat_chat_constants","./e_file_viewer_static_scl_page_file","./e_data_modules_stormcrow","./c_ui_contextual-nudge_campaign-contextual-nudge-section","./e_core_exception","./c_core_i18n","./c_internals_access-management-modal_types","./c_dotlottie_common_chunk-B7OIQIGJ","./c_spectrum_util_raf_throttle","./c_dig-icons_assets_ui-icon_line_upload-file","./c_dig-icons_assets_ui-icon_line_team","./c_views_copy_link_mini_modal_formatting","./c_internals_components_close-button","./c_lodash-es_lodash","./e_edison","./c_bem","./c_init_data_edison","./c_src_sink_index","./c_react-use_misc_util","./c_api_v2_routes_restorations_provider","./c_api_v2_unauthed_client","./c_hive_schemas_sharing-request_access_user_events","./c_core_notify","react-dom","./c_api_v2_routes_team_insights_provider","./c_security_csrf_hmac","./c_react-use_useEffectOnce","./c_pap-events_navigation_select_create_folder_action","react/jsx-runtime","./c_ui_locked-state-modal_open_locked_state_modal","./c_dig-components_card_index","./c_trial-plan-card_components_header","./c_dig-components_combinations_index","./c_dig-icons_assets_ui-icon_line_tag","./c_dig-icons_assets_ui-icon_line_upsell","./c_dig-icons_assets_ui-icon_line_stacks","metaserver/static/js/langpack","./c_over-quota_over-quota-sweep-blocking-modal_over_quota_sweep_blocking_modal_wrapper","./c_ui_contextual-nudge_atoms","./c_common_components_buttons"],(function(e,t,i,s,n,o,a,r,l,c,d,p,h,_,u,g,m,f,E,S,L,C,I,T,A,k,O,y,v,M,N,R,P,b,w,x,F,D,U,B,H,V){"use strict";function W(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var q=W(t);s.injectInternalStyle("/static/metaserver/static/js/sharing/views/copy_link_mini_modal/copy_link_mini_modal.module.out-vfll5aE9s.css",(e=>"._modal-wrapper_1iria_2{background-color:var(--dig-color__background__subtle);border-radius:var(--dig-radius__xlarge);padding:12px}._modal-body_1iria_8{padding:0}._pending-screen_1iria_13{row-gap:var(--dig-spacing__micro__medium)}._error-screen_1iria_23,._pending-screen_1iria_13{align-items:center;display:flex;flex-direction:column;height:133px;justify-content:center}._error-screen_1iria_23{row-gap:var(--dig-spacing__micro__small)}._error-screen-text_1iria_32{text-align:center;width:80%}._error-screen-text_1iria_32,._error-screen-title-text_1iria_40{align-items:center;display:flex;flex-direction:column}._error-screen-title-text_1iria_40{margin-bottom:0}._header-section_1iria_48{align-items:center;display:flex;padding:0}._drawer-header-section_1iria_55,._drawer-modal-body_1iria_60{padding-left:var(--dig-spacing__micro__large);padding-right:var(--dig-spacing__micro__large)}._header-section-text-container_1iria_65{line-height:18px;max-width:280px;width:100%}._header-section-primary-text_1iria_71{font-family:var(--dig-type__family__title)}._link-container_1iria_76{background-color:var(--dig-color__background__base)}._link-copied-badge_1iria_80{text-wrap:nowrap;align-items:center;background-color:var(--dig-color__success__surface--state-1);border-radius:var(--dig-radius__small);color:var(--dig-color__success__base);display:flex;font-family:var(--dig-type__family__action);font-size:var(--dig-type__size__action__small);letter-spacing:var(--dig-type__letterspacing__action);margin-right:calc(var(--dig-spacing__micro__xsmall)*-1);padding-left:var(--dig-spacing__micro__small);padding-right:var(--dig-spacing__micro__small);white-space:nowrap;width:fit-content}._link-copied-badge-checkmark_1iria_100{padding-right:var(--dig-spacing__micro__xsmall)}._link-accessory-button_1iria_104{margin-right:calc(var(--dig-spacing__micro__xsmall)*-1)}"));const Y="_modal-wrapper_1iria_2",G="_modal-body_1iria_8",K="_header-section_1iria_48",z="_link-accessory-button_1iria_104",j="copy-link-mini-modal__footer",Q=({linkAccessLevel:e,linkAudience:t,contentType:i,fileInfo:n,fileUploadInfo:a,browseFileInfo:l,user:c,sharedLink:d,openShareModalSettings:_,isDrawerMode:u,onClose:g})=>{const m=()=>{let e;return n?e=n.fq_path:a?e=a.dest+"/"+a.name:l&&(e=l.fq_path),e},f=()=>{s.ShareTibEventLogger.log(c.id,s.TiburonEventName.ClickManageLinkSettings,s.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_MINI_MODAL,{...s.buildExtraFromLinkMetadata(d),fq_path:m()}),_(s.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_MINI_MODAL)};return q.createElement(s.Box,{className:s.cx(j,{"drawer-mode-footer":u})},q.createElement(s.Box,{className:`${j}-content`},q.createElement(s.Text,{"data-testid":"link-info",style:{display:"flex",alignItems:"flex-start"},color:"subtle",size:u?"medium":"small"},(()=>{let e=null;return"public"===t?e=s.GlobeLine:"team"===t?e=h.TeamLine:"no_one"===t?e=p.LockLine:"password"===t&&(e=h.PasswordsLine),null===e?null:q.createElement(s.UIIcon,{"data-testid":"audience-icon",src:e,size:u?"medium":"small",style:{marginRight:"4px",paddingTop:u?"":"4px"}})})(),i?"public"===t?r.intl.formatMessage({id:"8kew9O",defaultMessage:"Anyone with this link can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===e,isFolder:"folder"===i}):"team"===t?r.intl.formatMessage({id:"LlzMnS",defaultMessage:"Team members with this link can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===e,isFolder:"folder"===i}):"password"===t?r.intl.formatMessage({id:"2yevNp",defaultMessage:"People with the password can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===e,isFolder:"folder"===i}):"no_one"===t?r.intl.formatMessage({id:"iv/o3s",defaultMessage:"Only people invited can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===e,isFolder:"folder"===i}):"":"public"===t?r.intl.formatMessage({id:"5n50wF",defaultMessage:"Anyone with this link can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===e}):"team"===t?r.intl.formatMessage({id:"HcnRtr",defaultMessage:"Team members with this link can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===e}):"password"===t?r.intl.formatMessage({id:"ego60b",defaultMessage:"People with the password can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===e}):"no_one"===t?r.intl.formatMessage({id:"VUeAlW",defaultMessage:"Only people invited can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===e}):""),!s.isShortcutFileType(m())&&q.createElement(s.Button,{variant:"transparent",size:u?"medium":"small",style:{marginLeft:"8px",alignSelf:"flex-start",paddingTop:u?"":"2px"},onClick:f},r.intl.formatMessage({id:"6BOuuN",defaultMessage:"Manage"}))),q.createElement(o.CampaignContextualNudgeSection,{fqPath:m(),onClose:g}))};Q.displayName="CopyLinkMiniModalFooterComponent";const X=s.requireCssWithComponent(Q,["/static/metaserver/static/css/dig-components/index.web-vflaJWt-u.css","/static/metaserver/static/css/sharing/copy_link_mini_modal-vflzblJLQ.css"]);class Z extends q.Component{render(){let e;if(this.props.isTriggeredAsShareModal)e=this.getContentName();else{if(this.props.stageType!==s.ModalStage.COPY&&this.props.stageType!==s.ModalStage.RESULT&&this.props.stageType!==s.ModalStage.ERROR_CLIENT)return null;e=_.formatHeaderText(r.intl,this.props.stageType,this.props.isLinkToComment)}const t=!this.props.isTriggeredAsShareModal&&q.createElement(q.Fragment,null,q.createElement(s.Text,{size:"small",color:"subtle"},q.createElement(s.Truncate,{location:.5},this.getContentName())));return q.createElement("div",{className:"_header-section-text-container_1iria_65","data-testid":"clmm-header"},q.createElement(s.Text,{size:"medium",isBold:!0,className:"_header-section-primary-text_1iria_71"},q.createElement(s.Truncate,{location:.5},e)),t)}getContentName(){let e;if(this.props.fileInfo?e=this.props.fileInfo.fq_path:this.props.fileUploadInfo?e=this.props.fileUploadInfo.dest+"/"+this.props.fileUploadInfo.name:this.props.browseFileInfo&&(e=this.props.browseFileInfo.fq_path),e){const t=e.split("/");return t[t.length-1]}}}Z.displayName="CopyLinkMiniModalHeaderComponent";const $=s.requireCssWithComponent(Z,["/static/metaserver/static/css/dig-components/index.web-vflaJWt-u.css","/static/metaserver/static/css/sharing/copy_link_mini_modal-vflzblJLQ.css"]);class J extends q.Component{constructor(){super(...arguments),this.handleCopy=()=>{this.props.onCopyToClipboard(s.CopyLinkMethod.MANUAL)},this.renderRightAccessory=()=>this.props.stage===s.ModalStage.RESULT?q.createElement(s.Text,{className:"_link-copied-badge_1iria_80",isBold:!0},q.createElement(s.UIIcon,{src:s.CheckmarkLine,className:"_link-copied-badge-checkmark_1iria_100"}),_.formatLinkCopiedBadge(r.intl)):this.props.stage===s.ModalStage.COPY?q.createElement(s.Button,{className:z,variant:"primary",size:"small",onClick:()=>{var e,t;return null===(t=(e=this.props).onClickCopyLink)||void 0===t?void 0:t.call(e,!0)}},_.formatCopyLinkButton(r.intl)):this.props.stage===s.ModalStage.ERROR_CLIENT?q.createElement(s.Button,{className:z,variant:"primary",size:"small",onClick:()=>{var e,t;return null===(t=(e=this.props).onClickCopyLink)||void 0===t?void 0:t.call(e,!0)}},_.formatTryAgainButton(r.intl)):null}componentDidMount(){this.props.shouldFocusOnLink&&this.props.focusOnInput()}render(){return q.createElement("div",{className:s.cx("copy-link-mini-modal__link",{"drawer-mode-link":this.props.isDrawerMode})},q.createElement(s.TextInput,{onCopy:this.handleCopy,size:"large","aria-label":r.intl.formatMessage({id:"qx4buj",defaultMessage:"Link for copy link click"}),value:this.props.sharedLink.url,readOnly:!0,onClick:this.props.focusOnInput,ref:this.props.inputRef,wrapperProps:{className:s.cx("link-container","_link-container_1iria_76")},withRightAccessory:this.renderRightAccessory()}))}}J.displayName="CopyLinkMiniModalLinkComponent";const ee=s.requireCssWithComponent(J,["/static/metaserver/static/css/dig-components/index.web-vflaJWt-u.css","/static/metaserver/static/css/sharing/copy_link_mini_modal-vflzblJLQ.css"]);class te extends q.default.Component{constructor(e){super(e),this.onWindowResize=g.throttle((()=>{this.props.isCenteredDisplayed||this.props.anchorRef.current||this.props.closeButtonHandler()}),500),this.handleClick=e=>{e.stopPropagation()},this.overlayRef=q.default.createRef(),this.tabRef=q.default.createRef(),this.state={tabIndex:0}}componentDidMount(){window.addEventListener("resize",this.onWindowResize)}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize)}componentDidUpdate(){var e;null===(e=this.overlayRef.current)||void 0===e||e.update()}render(){const{inputRef:e,stage:t,closeButtonHandler:i,linkAccessLevel:n,sharedLink:o,shouldFocusOnLink:a,focusOnInput:l,actionHandler:c,onCopyToClipboard:d,zIndexOverride:p,fileInfo:h,fileUploadInfo:g,browseFileInfo:m,linkAudience:f,user:E,openShareModalSettings:S,isLinkToComment:L,isTriggeredAsShareModal:C}=this.props,I=s.isDrawerMode(),T=q.default.createElement($,{stageType:t,isLinkToComment:L,fileInfo:h,fileUploadInfo:g,browseFileInfo:m,isTriggeredAsShareModal:C});let A=q.default.createElement(q.default.Fragment,null);o&&l&&e&&(A=q.default.createElement(ee,{sharedLink:o,focusOnInput:l,inputRef:e,onClickCopyLink:c,shouldFocusOnLink:a,onCopyToClipboard:d,stage:t,isDrawerMode:I}));let k=q.default.createElement(q.default.Fragment,null);if(o&&!C&&(t===s.ModalStage.RESULT||t===s.ModalStage.COPY||t===s.ModalStage.ERROR_CLIENT)){let e;"object"==typeof o&&".tag"in o&&(e=o[".tag"]),e||(e=o.file_type),k=q.default.createElement(X,{linkAccessLevel:n,linkAudience:f,contentType:e,fileInfo:h,fileUploadInfo:g,browseFileInfo:m,user:E,sharedLink:o,openShareModalSettings:S,isDrawerMode:I,onClose:i})}const O=q.default.createElement(q.default.Fragment,null,this.renderPendingScreen(),this.renderErrorScreen(),A,k),y=t===s.ModalStage.PENDING?()=>{}:i;if(I)return q.default.createElement(s.Drawer.ModalDrawer,{onRequestClose:y,"aria-label":"copy-link-mini-modal-drawer",isOpen:!0,alignment:"bottom",height:"100%",shouldAnimate:!0},q.default.createElement(s.Drawer.Container,null,q.default.createElement(s.Drawer.Header,{className:"_drawer-header-section_1iria_55"},q.default.createElement(s.Drawer.Layout,null,q.default.createElement(s.Drawer.LayoutItem,{width:"fill"},q.default.createElement(s.Drawer.Layout,null,T,q.default.createElement("div",{style:{marginLeft:"auto"}},q.default.createElement(u.CloseButton,{props:{onClick:y,ariaLabel:"Close"}})))))),q.default.createElement(s.Drawer.Body,{className:"_drawer-modal-body_1iria_60"},O)));if(this.props.isCenteredDisplayed)return q.default.createElement(s.Modal,{open:!0,isCentered:!0,width:442,onRequestClose:y,withCloseButton:_.formatCloseButtonLabel(r.intl),closeButtonProps:{disabled:t===s.ModalStage.PENDING}},q.default.createElement("div",{className:Y},q.default.createElement(s.Modal.Header,{className:K},T),q.default.createElement(s.Modal.Body,{className:G},O)));const v=q.default.createElement(s.IconButton,{"aria-label":"close","data-testid":"clmm-close-button",onClick:i,variant:"transparent",style:{position:"absolute",top:"8px",right:"8px"},disabled:t===s.ModalStage.PENDING},q.default.createElement(s.UIIcon,{src:s.CloseLine,"aria-label":""}));return q.default.createElement(s.LayerContext.Provider,{value:{zIndex:p||20}},q.default.createElement(s.ClickOutside,{isActive:!0,onClickOutside:t===s.ModalStage.PENDING?void 0:i,shouldPropagateMouseEvents:!1,isBlock:!0,shouldClickOutsideWhenDefaultPrevented:!0},q.default.createElement(s.Overlay,{className:"copy-link-mini-modal__overlay",anchorRef:this.props.anchorRef,placement:this.props.placement||"bottom",auto:!0,offsetDistance:null!=this.props.yOffsetDistance?this.props.yOffsetDistance:4,onClick:this.handleClick,ref:this.overlayRef,style:{width:442,padding:0},onKeyDown:e=>{if(this.overlayRef.current){if("Escape"===e.key)return this.props.closeButtonHandler(),e.preventDefault(),void e.nativeEvent.stopImmediatePropagation();if("Tab"===e.key){if(!this.tabRef||!this.tabRef.current)return;e.preventDefault();const t=this.tabRef.current.querySelectorAll('button:not([disabled]), [href]:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"]):not([disabled])');let i,s=this.state.tabIndex;for(let e=0;e<t.length;e++){if(t[e]===document.activeElement){s=e;break}}i=e.shiftKey?(s-1+t.length)%t.length:(s+1)%t.length,t[i].focus(),this.setState({tabIndex:i})}}}},q.default.createElement("div",{className:Y,ref:this.tabRef},v,q.default.createElement(s.Modal.Header,{className:K},T),q.default.createElement(s.Modal.Body,{className:G},O)))))}renderPendingScreen(){return this.props.stage===s.ModalStage.PENDING?q.default.createElement(s.Box,{className:"_pending-screen_1iria_13"},q.default.createElement(s.Spinner,null),q.default.createElement(s.Text,{color:"subtle"},_.formatPendingScreenText(r.intl))):null}renderErrorScreen(){return this.props.stage===s.ModalStage.ERROR_SERVER?q.default.createElement(s.Box,{className:"_error-screen_1iria_23"},q.default.createElement(s.UIIcon,{src:s.FailPictogram,size:"large"}),q.default.createElement(s.Box,{className:"_error-screen-text_1iria_32"},q.default.createElement(s.Title,{className:"_error-screen-title-text_1iria_40",weightVariant:"emphasized",size:"small"},_.formatErrorScreenTitle(r.intl)),q.default.createElement(s.Text,{color:"subtle"},this.props.errorMessage))):null}}te.displayName="CopyLinkMiniModalOverlayComponent";const ie=s.requireCssWithComponent(te,["/static/metaserver/static/css/sharing/copy_link_mini_modal-vflzblJLQ.css","/static/metaserver/static/css/dig-components/index.web-vflaJWt-u.css"]);class se extends q.default.Component{constructor(e){super(e),this.logPAPAsShareModal=e=>{var t,i;const n=this.loggingKey,o="start"===e.loggingAction?s.UDCL.logStart:s.UDCL.logEnd,a="end"===e.loggingAction?e.eventState:void 0,r={actionElement:this.actionElement,actionSurface:null!==(t=this.actionSurface)&&void 0!==t?t:"unknown",isDir:"false",screen:null!==(i=this.screen)&&void 0!==i?i:"unknown"};o("ops.sm24.browse_load",{tags:r,key:n,eventState:a}),o(s.PAP_Load_ShareModal({eventState:a,actionElement:this.actionElement,actionSurface:this.actionSurface,contentAction:"share",sharedObjType:"file",fileExtension:this.props.file?s.getExtension(this.props.file):"",isDir:!1,screen:this.screen}),{tags:r,key:n})},this.getScreen=()=>this.props.isTriggeredAsShareModal?"pointer_modal_screen":this.props.isFromShareMe24Modal?"share_screen":void 0,this.getPAPLoggerContent=()=>this.props.file?s.getContentFromFile(this.props.file):this.props.browseFile?s.getContentFromFile(this.props.browseFile):this.props.fileUpload?s.getContentFromFileUpload(this.props.fileUpload):void 0,this.appendSenderTrackeyToLink=()=>{var e;this.sharedLink&&this.sharedLink.url&&!s.isShortcutFileType(null===(e=this.props.file)||void 0===e?void 0:e.fq_path)&&(this.sharedLink=s.getNewLinkMetadataWithSenderTrackeyURL(this.sharedLink,this.senderTrackey))},this.appendCommentIdToLink=()=>{this.sharedLink&&this.sharedLink.url&&this.props.commentId&&(this.sharedLink=s.getNewLinkMetadataWithUrlFragment(this.sharedLink,"comment_id="+this.props.commentId))},this.handleClipboardWriterCopyLinkToClipboard=()=>{var e;this.appendSenderTrackeyToLink(),this.appendCommentIdToLink(),null===(e=this.props.clipboardWriter)||void 0===e||e.write(this.sharedLink.url),this.handleClipboardSuccess(s.CopyLinkMethod.CLIPBOARD_API)},this.handleCopyLinkToClipboard=(e=!1)=>{e&&s.logPAPCopySharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:this.sharedLink,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen}),this.appendSenderTrackeyToLink(),this.appendCommentIdToLink(),s.copyToClipboard(this.sharedLink.url,(()=>{this.handleClipboardSuccess(s.CopyLinkMethod.EXEC_COMMAND)}),this.handleClipboardFailure)},this.handleClipboardSuccess=e=>{e!==s.CopyLinkMethod.MANUAL&&(this.setState({stage:s.ModalState.RESULT}),this.focusOnInput(),setTimeout((()=>{this.setState({stage:s.ModalState.COPY})}),5e3)),this.logEvent(s.TiburonEventName.CopySharedLink,{created_new_link:this.isLinkNewlyCreated,copy_method:e,access:this.getAccessLevel(),timing:this.getLinkActionTTI(this.startCopyLinkTime),sender_trackey:this.senderTrackey,commentId:this.props.commentId}),s.logPAPCopySharedLinkEvent({eventState:"success",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:this.sharedLink,httpCode:this.httpCode,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen})},this.handleOnCopyToClipboard=e=>{s.logPAPCopySharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:this.sharedLink,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen}),this.handleClipboardSuccess(e)},this.handleClipboardFailure=()=>{this.copyLinkToClipboardNewAPI()},this.copyLinkToClipboardNewAPI=()=>{if(navigator.clipboard){const e=this.sharedLink.url;navigator.clipboard.writeText(e).then((()=>{this.handleClipboardSuccess(s.CopyLinkMethod.CLIPBOARD_API)}),(()=>{this.handleClipboardFailureNewAPI()}))}else this.handleClipboardFailureNewAPI()},this.handleClipboardFailureNewAPI=()=>{this.exceptionType=s.CopyLinkException.FAILED_COPY_TO_CLIPBOARD,this.failToFetchCopyLinkHelper()},this.getLinkActionTTI=e=>Date.now()-e,this.onClose=()=>{!this.props.isFromShareMe24Modal||"browse_screen"!==this.actionSurface&&"quick-view-browse"!==this.actionSurface&&"file_choose"!==this.actionSurface||s.trackUserLeapEvent(s.SharingUserLeapEvent.SM24_OOB_SHARE_COMPLETE_CLMM_CLOSED,this.origin),this.props.setIsCreatingSharedLink(!1,this.fileIdOrPath),this.props.userActionSource===s.ActionSourceValue.BUTTON&&this.props.onHoverLocked&&this.props.onHoverLocked({isOpen:!1}),this.props.onActionFlowComplete&&this.props.onActionFlowComplete(),this.setState({isOpen:!1})},this.focusOnInput=()=>{this.inputRef.current&&this.inputRef.current.select()},this.openShareModalSettings=async e=>{const t="editor"===this.getAccessLevel()?"edit_link_settings":"view_link_settings",i="copy_link_mini_modal";let n;if(this.props.file)n=this.props.file;else if(this.props.fileUpload){const e=this.props.fileUpload.dest+"/"+this.props.fileUpload.name;try{n=await s.getFileInfo({file:{".tag":"fq_path",fq_path:e}})}catch(e){return a.reportStack("Copy Link Mini Modal - get_file_info error",{severity:a.SEVERITY.CRITICAL,tags:["sm24_error","copy_link_mini_modal"],exc_extra:{action_surface:this.actionSurface,action_element:i,file_extension:s.getExtension({filename:this.props.fileUpload.name})}}),void s.sharingNotificationError(_.shareNotificationErrorMessage(r.intl))}}else this.props.browseFile&&(n=this.props.browseFile);if(!n)return a.reportStack("SM24 Access Management - invalid fileOrFolder",{severity:a.SEVERITY.CRITICAL,tags:["sm24_error","copy_link_mini_modal"],exc_extra:{action_surface:this.actionSurface,action_element:this.actionElement}}),void s.sharingNotificationError(_.shareNotificationErrorMessage(r.intl));s.asyncShowAccessManagementBrowse({fileOrFolder:n,user:this.props.user,actionSurface:this.actionSurface,actionElement:i,sessionId:Math.random().toString(),initialScreen:l.Screen.SETTINGS,initialSettingsTab:t}),this.onClose()},this.inputRef=q.default.createRef(),this.state={isOpen:!0,stage:s.ModalState.PENDING},this.fileIdOrPath=this.getFileIdOrPath(),this.loggingKey=s.UUID.v4();const{actionSurface:t,actionElement:i,origin:n,contentAction:o}=this.getOriginAndAction();this.actionSurface=t,this.actionElement=i,this.contentAction=o,this.origin=n,this.requestedAccessLevel="default",this.screen=this.getScreen(),this.senderTrackey=s.vendSenderTrackey()}componentDidMount(){s.logPAPCreateSharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,screen:this.screen}),s.logPAPCopySharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen}),this.props.isTriggeredAsShareModal&&this.logPAPAsShareModal({loggingAction:"start"}),this.createSharedLink()}componentDidUpdate(e,t){!this.props.isTriggeredAsShareModal||t.stage!==s.ModalState.PENDING||this.state.stage!==s.ModalState.RESULT&&this.state.stage!==s.ModalState.COPY||this.logPAPAsShareModal({loggingAction:"end",eventState:"success"}),this.props.isTriggeredAsShareModal&&t.stage!==s.ModalState.ERROR&&this.state.stage===s.ModalState.ERROR&&this.logPAPAsShareModal({loggingAction:"end",eventState:"failed"})}createSharedLink(){this.props.setIsCreatingSharedLink(!0,this.fileIdOrPath),this.props.userActionSource===s.ActionSourceValue.BUTTON&&this.props.onHoverLocked&&this.props.onHoverLocked({isOpen:!0}),this.startCreateLinkTime=Date.now();const e=s.getApiClient(this.props.user),t=this.requestedAccessLevel;e.createSharedLinkNonAlpha({fileIdOrPath:this.fileIdOrPath,settings:{access:t}}).then((e=>{this.startCopyLinkTime=Date.now(),this.succeedToFetchLinkHelper(e,!0),this.logEvent(s.TiburonEventName.AttemptCreateSharedLinkWithSettings,{access:this.getAccessLevel(),commentId:this.props.commentId})})).catch((e=>{this.startCopyLinkTime=Date.now(),e.error[".tag"]===s.CopyLinkException.SHARED_LINK_ALREADY_EXISTS?this.succeedToFetchLinkHelper(e.error.shared_link_already_exists.metadata,!1,e):e.error[".tag"]===s.CopyLinkException.ACCESS_DENIED?(this.exceptionType=s.CopyLinkException.ACCESS_DENIED,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===s.CopyLinkException.SETTINGS_ERROR&&e.error.settings_error[".tag"]===s.CopyLinkException.NOT_AUTHORIZED?(this.exceptionType=s.CopyLinkException.NOT_AUTHORIZED,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===s.CopyLinkException.PATH&&e.error.path[".tag"]===s.CopyLinkException.NOT_FOUND?(this.exceptionType=s.CopyLinkException.NOT_FOUND,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===s.CopyLinkException.EMAIL_NOT_VERIFIED?(this.exceptionType=s.CopyLinkException.EMAIL_NOT_VERIFIED,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===s.CopyLinkException.BANNED_MEMBER?(this.exceptionType=s.CopyLinkException.BANNED_MEMBER,this.userMessage=e.message,this.failToFetchCopyLinkHelper(e)):(this.exceptionType=e.error[".tag"]?e.error[".tag"]:s.CopyLinkException.UNDEFINED_ERROR,this.failToFetchCopyLinkHelper(e)),this.logEvent(s.TiburonEventName.AttemptCreateSharedLinkWithSettings,{access:t,timing:this.getLinkActionTTI(this.startCopyLinkTime),commentId:this.props.commentId})}))}succeedToFetchLinkHelper(e,t,i){var n;this.sharedLink=e,this.isLinkNewlyCreated=t,this.httpCode=t?200:i&&i.raw&&i.raw.status,this.logEvent(s.TiburonEventName.SucceedCreateSharedLinkWithSettings,{created_new_link:t,http_status_code:this.httpCode,response_status:"success",is_alpha:!1,access:this.getAccessLevel(),timing:this.getLinkActionTTI(this.startCreateLinkTime),commentId:this.props.commentId}),s.logPAPCreateSharedLinkEvent({eventState:"success",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:e,httpCode:this.httpCode,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,screen:this.screen}),t&&this.props.file&&!this.props.isSearchMode&&s.getStoreForSharedWith().dispatch(s.sharedLinkDataOutOfDate(this.props.file.fq_path)),s.isBrowserCopyEnabled()?this.handleCopyLinkToClipboard():this.props.clipboardWriter?this.handleClipboardWriterCopyLinkToClipboard():(this.setState({stage:s.ModalState.COPY}),s.logPAPCopySharedLinkEvent({eventState:"canceled",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:e,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen}));const o=null!==(n=this.props.file)&&void 0!==n?n:this.props.browseFile;if(o){const e={file_name:s.getFilename(o),file_extension:s.getExtension(o),file_path:o.fq_path};o.is_dir?s.publishEvent(s.CampaignEvents.FOLDER_OUT_OF_BAND_SHARE_SUCCESS,{context:{...e,is_team_folder:o.is_in_team_folder_tree?"true":"false"}}):s.publishEvent(s.CampaignEvents.FILE_OUT_OF_BAND_SHARE_SUCCESS,{context:e})}}failToFetchCopyLinkHelper(e){e&&(this.logEvent(s.TiburonEventName.FailCreateSharedLinkWithSettings,{error_message:this.exceptionType,http_status_code:e.raw&&e.raw.status,is_alpha:!1,timing:this.getLinkActionTTI(this.startCreateLinkTime),commentId:this.props.commentId}),s.logPAPCreateSharedLinkEvent({eventState:s.getErrorState(this.exceptionType),actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),httpCode:e&&e.raw&&e.raw.status,exception:this.exceptionType,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,screen:this.screen})),this.setState({stage:s.ModalState.ERROR}),this.logEvent(s.TiburonEventName.CopySharedLinkFailure,{error:this.exceptionType,timing:this.getLinkActionTTI(this.startCopyLinkTime),commentId:this.props.commentId}),s.logPAPCopySharedLinkEvent({eventState:s.getErrorState(this.exceptionType),actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),httpCode:e&&e.raw&&e.raw.status,exception:this.exceptionType,metadata:this.sharedLink?this.sharedLink:void 0,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen})}getFileIdOrPath(){var e,t;return(null===(e=this.props.file)||void 0===e?void 0:e.file_id)||(null===(t=this.props.file)||void 0===t?void 0:t.fq_path)||this.props.filePath}getAccessLevel(){const e=this.sharedLink?this.sharedLink.link_permissions.link_access_level:void 0;let t="viewer";return e&&(t=e.hasOwnProperty(".tag")?e[".tag"]:e),t}getLinkVisibilityMapping(e){switch(e){case"public":case"password":case"no_one":return e;case"team_only":return"team";case"team_and_password":return"password";case"shared_folder_only":case"only_you":return"no_one"}}getLinkAudience(){if(!this.sharedLink)return;let e;const t=this.sharedLink.link_permissions;if(t.effective_audience)e=t.effective_audience,"object"==typeof e&&".tag"in e&&(e=e[".tag"]);else{let i;i=t.resolved_visibility,"object"==typeof i&&".tag"in i&&(i=i[".tag"]),e=this.getLinkVisibilityMapping(i)}return e}logEvent(e,t){var n,o;let a=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_BUTTON;this.props.isFromShareMe24Modal?a=this.props.origin:this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.RIGHT_SIDEBAR?a=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS_BUTTON:this.props.userActionSource===s.ActionSourceValue.OVERFLOW_MENU?a=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_OVERFLOW_MENU:this.props.userActionSource===s.ActionSourceValue.COPY_LINK_FROM_UPLOAD_MODAL?a=s.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_FROM_UPLOAD_MODAL:this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.PREVIEW_TITLEBAR?a=s.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE_TITLEBAR:this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.CONTENT_TILE?a=this.props.isSearchMode?s.SHARE_ACTION_ORIGIN_TYPE.SEARCH_CONTENT_TILE_BUTTON:s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_CONTENT_TILE_BUTTON:this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE?a=this.props.isSearchMode?s.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_SEARCH_CONTENT_TILE:s.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_BROWSE_CONTENT_TILE:this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.COMMENTS_SIDEBAR&&(a=s.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_COMMENTS_SIDEBAR);const r=i.get_browser_info();s.ShareTibEventLogger.log(this.props.user.id,e,a,{...s.buildExtraFromLinkMetadata(this.sharedLink),file_id:null===(n=this.props.file)||void 0===n?void 0:n.file_id,fq_path:(null===(o=this.props.file)||void 0===o?void 0:o.fq_path)||this.props.filePath,browser:r.browser,browser_version:r.version,...t}),e===s.TiburonEventName.CopySharedLink&&s.trackUserLeapEvent(s.SharingUserLeapEvent.SHARE_LINK_COPY_SUCCESS,a)}getOriginAndAction(){let e=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_BUTTON,t="browse_screen",i="browse_directory_row";const n=this.props.isTriggeredAsShareModal?"share":"copy_link";return this.props.isFromShareMe24Modal?(e=this.props.origin,t=this.props.actionSurface,i=this.props.actionElement):this.props.isSearchMode?(t="search",i="search_directory_row",this.props.userActionSource===s.ActionSourceValue.OVERFLOW_MENU?i="content_overflow_menu":this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.CONTENT_TILE?(e=s.SHARE_ACTION_ORIGIN_TYPE.SEARCH_CONTENT_TILE_BUTTON,i="content_tile"):this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE&&(e=s.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_SEARCH_CONTENT_TILE,t="search_quick_view",i=s.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE)):this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.RIGHT_SIDEBAR?(e=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,i="action_bar_overflow_menu"):this.props.userActionSource===s.ActionSourceValue.OVERFLOW_MENU?this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.FOLDER_SETTINGS_MENU?(e=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS,i="context_menu"):(e=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_OVERFLOW_MENU,i="content_overflow_menu"):this.props.userActionSource===s.ActionSourceValue.COPY_LINK_FROM_UPLOAD_MODAL?(e=s.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_FROM_UPLOAD_MODAL,i="upload_modal"):this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.PREVIEW_TITLEBAR?(e=s.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE_TITLEBAR,t="previews",i="preview_titlebar"):this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.CONTENT_TILE?(e=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_CONTENT_TILE_BUTTON,t="browse_screen",i="content_tile"):this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE?(e=s.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_BROWSE_CONTENT_TILE,t="browse_quick_view",i=s.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE):this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.COMMENTS_SIDEBAR&&(e=s.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_COMMENTS_SIDEBAR,t="previews",i="comment"),{origin:e,actionSurface:t,actionElement:i,contentAction:n}}render(){if(!this.state.isOpen)return null;this.appendSenderTrackeyToLink(),this.appendCommentIdToLink();const e=this.props.isCenteredDisplayed?{isCenteredDisplayed:!0}:{isCenteredDisplayed:!1,anchorRef:this.props.anchorRef,yOffsetDistance:this.props.yOffsetDistance,placement:this.props.placement};switch(this.state.stage){case s.ModalState.PENDING:return q.default.createElement(ie,{stage:s.ModalStage.PENDING,closeButtonHandler:this.onClose,zIndexOverride:this.props.zIndexOverride,isLinkToComment:!!this.props.commentId,...e});case s.ModalState.COPY:return q.default.createElement(ie,{stage:s.ModalStage.COPY,linkAccessLevel:this.getAccessLevel(),actionHandler:this.handleCopyLinkToClipboard,closeButtonHandler:this.onClose,sharedLink:this.sharedLink,focusOnInput:this.focusOnInput,inputRef:this.inputRef,shouldFocusOnLink:!1,onCopyToClipboard:this.handleOnCopyToClipboard,zIndexOverride:this.props.zIndexOverride,fileInfo:this.props.file,fileUploadInfo:this.props.fileUpload,browseFileInfo:this.props.browseFile,linkAudience:this.getLinkAudience(),user:this.props.user,openShareModalSettings:this.openShareModalSettings,isLinkToComment:!!this.props.commentId,isTriggeredAsShareModal:this.props.isTriggeredAsShareModal,...e});case s.ModalState.ERROR:if(this.exceptionType!==s.CopyLinkException.FAILED_COPY_TO_CLIPBOARD){if(this.exceptionType===s.CopyLinkException.BANNED_MEMBER&&this.userMessage)return this.onClose(),s.failBannerWithHelpCenter(_.stripApiErrorMessagePrefix(this.userMessage),s.ABUSE_HELP_ARTICLE_LINK),null;const t=_.formatServerErrorMessage(r.intl,this.exceptionType);return q.default.createElement(ie,{stage:s.ModalStage.ERROR_SERVER,closeButtonHandler:this.onClose,errorMessage:t,zIndexOverride:this.props.zIndexOverride,isLinkToComment:!!this.props.commentId,...e})}return q.default.createElement(ie,{stage:s.ModalStage.ERROR_CLIENT,linkAccessLevel:this.getAccessLevel(),actionHandler:this.handleCopyLinkToClipboard,closeButtonHandler:this.onClose,sharedLink:this.sharedLink,focusOnInput:this.focusOnInput,inputRef:this.inputRef,shouldFocusOnLink:!0,onCopyToClipboard:this.handleOnCopyToClipboard,zIndexOverride:this.props.zIndexOverride,fileInfo:this.props.file,fileUploadInfo:this.props.fileUpload,browseFileInfo:this.props.browseFile,linkAudience:this.getLinkAudience(),user:this.props.user,openShareModalSettings:this.openShareModalSettings,isLinkToComment:!!this.props.commentId,...e});case s.ModalState.RESULT:return q.default.createElement(ie,{stage:s.ModalStage.RESULT,linkAccessLevel:this.getAccessLevel(),actionHandler:this.handleCopyLinkToClipboard,closeButtonHandler:this.onClose,sharedLink:this.sharedLink,focusOnInput:this.focusOnInput,inputRef:this.inputRef,shouldFocusOnLink:!0,onCopyToClipboard:this.handleOnCopyToClipboard,zIndexOverride:this.props.zIndexOverride,fileInfo:this.props.file,fileUploadInfo:this.props.fileUpload,browseFileInfo:this.props.browseFile,linkAudience:this.getLinkAudience(),user:this.props.user,openShareModalSettings:this.openShareModalSettings,isLinkToComment:!!this.props.commentId,isTriggeredAsShareModal:this.props.isTriggeredAsShareModal,...e})}}}se.displayName="CopyLinkMiniModalComponent";const ne=e=>q.default.createElement(se,{...e});ne.displayName="CopyLinkMiniModalWithHooks";const oe=e=>q.default.createElement(n.QueryClientProvider,{client:n.queryClient},q.default.createElement(re,{copyLinkMiniModalProps:e},(t=>q.default.createElement(o.ShareBlockingWrapper,{withLockedStateModal:e.withLockedStateModal,action:s.LockedStateModalAction.SHARE_LINK,onStatusChange:t=>{var i,n;if([s.Status.USER_ABORTED_ACTION,s.SweepStatus.RESTRICTED].includes(t)){const t=(null===(i=e.file)||void 0===i?void 0:i.file_id)||(null===(n=e.file)||void 0===n?void 0:n.fq_path)||e.filePath;e.setIsCreatingSharedLink(!1,t),e.onHoverLocked&&e.onHoverLocked({isOpen:!1})}}},q.default.createElement(ne,{...e,...t})))));oe.displayName="CopyLinkMiniModalWithProviders";const ae=s.requireCssWithComponent(oe,["/static/metaserver/static/css/sharing/copy_link_mini_modal-vflzblJLQ.css","/static/metaserver/static/css/dig-components/index.web-vflaJWt-u.css"]);ae.show=(e,t)=>{s.Modal$1.showInstance(q.default.createElement(ae,{...e}),!0,t)};const re=({copyLinkMiniModalProps:e,children:t})=>{const[i,s]=q.default.useState(null),n=e.isCenteredDisplayed?void 0:e.anchorRef.current;return q.default.useEffect((()=>{if(!n)return;const e=n.getBoundingClientRect(),t=new DOMRect(e.x,e.y,e.width,e.height);s({current:{getBoundingClientRect:()=>t}})}),[n]),e.isCenteredDisplayed?q.default.createElement(q.default.Fragment,null,t({})):q.default.createElement(q.default.Fragment,null,i&&t({anchorRef:i}))};re.displayName="DisplayPropsWrapper",e.CopyLinkMiniModal=ae,e.CopyLinkMiniModalComponent=se}));
//# sourceMappingURL=c_views_copy_link_mini_modal_copy_link_mini_modal.after-display.js-vfl6NuxAl.map

//# debugId=4886c64d-2ff6-34e1-9df1-f4ccaeee747d